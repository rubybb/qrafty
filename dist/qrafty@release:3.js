(()=>{var t={7670:t=>{function e(t,e,i,n){Object.defineProperty(t,e,{enumerable:!1,configurable:!1,get:function(){return i[n]},set:function(t){i[n]=t}})}t.exports={defineAliases:function(t){e(t,"image_whitelist",t,"imageWhitelist"),e(t,"mouseDispatch",t.s("Mouse"),"processEvent"),e(t,"mouseButtonsDown",t.s("Mouse"),"_buttonDown"),e(t,"lastEvent",t.s("Mouse"),"lastMouseEvent"),e(t,"mouseObjs",t.s("Mouse"),"mouseObjs"),e(t,"keyboardDispatch",t.s("Keyboard"),"processEvent"),e(t,"keydown",t.s("Keyboard"),"_keyDown"),e(t,"resetKeyDown",t.s("Keyboard"),"resetKeyDown"),e(t,"touchDispatch",t,"_touchDispatch"),e(t,"touchObjs",t.s("Touch"),"touchObjs"),t.touchHandler={},e(t.touchHandler,"fingers",t.s("Touch"),"touchPoints")}}},3654:(t,e,i)=>{var n=i(1167);function r(t){this.button=t}function s(t){this.key=t}function o(t){this.inputs=t}r.prototype={isDown:function(){var t=this.mouseSystem;return t||(this.mouseSystem=t=n.s("Mouse")),t.isButtonDown(this.button)}},s.prototype={isDown:function(){var t=this.keyboardSystem;return t||(this.keyboardSystem=t=n.s("Keyboard")),t.isKeyDown(this.key)}},o.prototype={timeDown:null,isActive:function(){for(var t in this.inputs)if(this.inputs[t].isDown())return this.timeDown||(this.timeDown=Date.now()),!0;return delete this.timeDown,!1},destroy:function(){for(var t in this.inputs)"function"==typeof this.inputs[t].destroy&&this.inputs[t].destroy()}},n.s("Controls",{init:function(){this._dpads={},this._triggers={},n.s("Mouse").bind("MouseDown",this.updateTriggers.bind(this)),n.s("Mouse").bind("MouseUp",this.updateTriggers.bind(this)),n.s("Mouse").bind("DoubleClick",this.updateTriggers.bind(this)),n.s("Mouse").bind("Click",this.updateTriggers.bind(this))},events:{EnterFrame:"runEvents",KeyDown:"updateTriggers",KeyUp:"updateTriggers"},updateTriggers:function(t){for(var e in this._triggers){var i=this._triggers[e];this.updateTriggerInput(i)}},runEvents:function(){for(var t in this._dpads){var e=this._dpads[t];e.oldX=e.x,e.oldY=e.y,this.updateDpadInput(e,e.multipleDirectionBehavior),this.updateActiveDirection(e,e.normalize),e.event.x=e.x,e.event.y=e.y,e.x===e.oldX&&e.y===e.oldY||n.trigger("DirectionalInput",e.event)}},getDpad:function(t){return this._dpads[t]},isTriggerDown:function(t){return this._triggers[t].active},defineTriggerGroup:function(t,e){var i;if(Array.isArray(e))i=e;else{if(i=[],e.mouseButtons)for(var a in e.mouseButtons)i.push(new r(e.mouseButtons[a]));if(e.keys)for(var h in e.keys)i.push(new s(e.keys[h]))}this.destroyTriggerGroup(t),this._triggers[t]={name:t,input:new o(i),downFor:0,active:!1},n.trigger("ControlDefined",{type:"TriggerGroup",name:t})},destroyTriggerGroup:function(t){this._triggers[t]&&(this._triggers[t].input.destroy(),delete this._triggers[t],n.trigger("ControlDestroyed",{type:"TriggerGroup",name:t}))},defineDpad:function(t,e,i){var r={};for(var a in e){var h=e[a],u=n.keys[a]||a;r[h]||(r[h]=[]),r[h].push(new s(u))}var c={};for(var l in r)c[l]={input:new o(r[l]),active:!1,n:this.parseDirection(l)};void 0===i&&(i={}),void 0===i.normalize&&(i.normalize=!1),void 0===i.multipleDirectionBehavior&&(i.multipleDirectionBehavior="all"),this.destroyDpad(t),this._dpads[t]={name:t,directions:c,x:0,y:0,oldX:0,oldY:0,event:{x:0,y:0,name:t},normalize:i.normalize,multipleDirectionBehavior:i.multipleDirectionBehavior},n.trigger("ControlDefined",{type:"Dpad",name:t})},destroyDpad:function(t){if(this._dpads[t]){for(var e in this._dpads[t].parsedDefinition)this._dpads[t].parsedDefinition[e].input.destroy();delete this._dpads[t],n.trigger("ControlDestroyed",{type:"Dpad",name:t})}},parseDirection:function(t){return{x:Math.round(1e3*Math.cos(t*(Math.PI/180)))/1e3,y:Math.round(1e3*Math.sin(t*(Math.PI/180)))/1e3}},updateActiveDirection:function(t,e){var i=0,n=0;for(var r in t.directions){var s=t.directions[r];s.active&&(i+=s.n.x,n+=s.n.y)}if(i=-1e-10<i&&i<1e-10?0:i,n=-1e-10<n&&n<1e-10?0:n,e){var o=Math.sqrt(i*i+n*n);o>0&&(i/=o,n/=o)}t.x=i,t.y=n},updateTriggerInput:function(t){t.active?t.input.isActive()||(t.active=!1,n.trigger("TriggerInputUp",t),t.downFor=0):t.input.isActive()&&(t.downFor=Date.now()-t.input.timeDown,t.active=!0,n.trigger("TriggerInputDown",t))},updateDpadInput:function(t,e){var i,n,r;for(i in t.directions)(n=t.directions[i]).active=!1,n.input.isActive()&&("all"===e?n.active=!0:r?("first"===e&&r.input.timeDown>n.input.timeDown&&(r=n),"last"===e&&r.input.timeDown<n.input.timeDown&&(r=n)):r=n);r&&(r.active=!0)}})},1593:(t,e,i)=>{var n=i(1167);n.c("Draggable",{_origX:null,_origY:null,_oldX:null,_oldY:null,_dir:null,required:"MouseDrag",events:{StartDrag:"_startDrag",Dragging:"_drag"},enableDrag:function(){return this.uniqueBind("Dragging",this._drag),this},disableDrag:function(){return this.unbind("Dragging",this._drag),this},dragDirection:function(t){if(void 0===t)this._dir=null;else if(+t===t)this._dir={x:Math.cos(t/180*Math.PI),y:Math.sin(t/180*Math.PI)};else if(0===t.x&&0===t.y)this._dir={x:0,y:0};else{var e=Math.sqrt(t.x*t.x+t.y*t.y);this._dir={x:t.x/e,y:t.y/e}}return this},_startDrag:function(t){this._origX=t.realX,this._origY=t.realY,this._oldX=this._x,this._oldY=this._y},_drag:function(t){if(this._dir){if(0!==this._dir.x||0!==this._dir.y){var e=(t.realX-this._origX)*this._dir.x+(t.realY-this._origY)*this._dir.y;this.x=this._oldX+e*this._dir.x,this.y=this._oldY+e*this._dir.y}}else this.x=this._oldX+(t.realX-this._origX),this.y=this._oldY+(t.realY-this._origY)}}),n.c("Controllable",{init:function(){this._inputBindings={DirectionalInput:{},TriggerInputDown:{},TriggerInputUp:{}}},events:{DirectionalInput:function(t){this._inputBindings.DirectionalInput[t.name]&&this._inputBindings.DirectionalInput[t.name].call(this,t)},TriggerInputDown:function(t){this._inputBindings.TriggerInputDown[t.name]&&this._inputBindings.TriggerInputDown[t.name].call(this,t)},TriggerInputUp:function(t){this._inputBindings.TriggerInputUp[t.name]&&this._inputBindings.TriggerInputUp[t.name].call(this,t)}},linkInput:function(t,e,i){return this._inputBindings[t][e]=i,this},unlinkInput:function(t,e){return delete this._inputBindings[t][e],this},disableControls:!1,enableControl:function(){return this.disableControls=!1,this},disableControl:function(){return this.disableControls=!0,this}}),n.c("Multiway",{_speed:null,init:function(){this.requires("Motion, Controllable"),this._dpadName="MultiwayDpad"+this[0],this._speed={x:150,y:150},this._direction={x:0,y:0}},remove:function(){this.disableControls||(this.vx=this.vy=0),this.unlinkInput("DirectionalInput",this._dpadName),n.s("Controls").destroyDpad(this._dpadName)},events:{UpdateFrame:function(){this.disableControls||(void 0!==this._speed.x&&null!==this._speed.x&&(this.vx=this._speed.x*this._direction.x),void 0!==this._speed.y&&null!==this._speed.y&&(this.vy=this._speed.y*this._direction.y))}},_updateDirection:function(t){this._direction.x=t.x,this._direction.y=t.y},multiway:function(t,e,i){var r=n.s("Controls");return e?this.speed(t):e=t,r.defineDpad(this._dpadName,e,i),this.linkInput("DirectionalInput",this._dpadName,this._updateDirection),this},speed:function(t){return"object"==typeof t?(this._speed.x=t.x,this._speed.y=t.y):(this._speed.x=t,this._speed.y=t),this}}),n.c("Jumper",{_jumpSpeed:300,canJump:!0,init:function(){this.requires("Supportable, Motion, Controllable")},remove:function(){this.unlinkInput("TriggerInputDown",this._jumpTriggerName),n.s("Controls").destroyTriggerGroup(this._jumpTriggerName)},_keydown_jumper:function(t){this.disableControls||this.jump()},jump:function(){var t=this.ground;return this.canJump=!!t,this.trigger("CheckJumping",t),this.canJump&&(this.vy=-this._jumpSpeed),this},jumper:function(t,e){if(e?this._jumpSpeed=t:e=t,this._jumpTriggerName="JumpTrigger"+this[0],Array.isArray(e)){for(var i=[],r=0;r<e.length;++r){var s=e[r],o=n.keys[s]||s;i.push(o)}n.s("Controls").defineTriggerGroup(this._jumpTriggerName,{keys:i})}else n.s("Controls").defineTriggerGroup(this._jumpTriggerName,e);return this.linkInput("TriggerInputDown",this._jumpTriggerName,this._keydown_jumper),this},jumpSpeed:function(t){return this._jumpSpeed=t,this}}),n.c("Fourway",{init:function(){this.requires("Multiway")},fourway:function(t,e){return this.multiway(t||this._speed,{UP_ARROW:-90,DOWN_ARROW:90,RIGHT_ARROW:0,LEFT_ARROW:180,W:-90,S:90,D:0,A:180,Z:-90,Q:180},e),this}}),n.c("Twoway",{init:function(){this.requires("Multiway, Jumper")},twoway:function(t,e){var i=t||this._speed;return this.multiway({x:i},{RIGHT_ARROW:0,LEFT_ARROW:180,D:0,A:180,Q:180}),this.jumper(e||2*t||this._jumpSpeed,[n.keys.UP_ARROW,n.keys.W,n.keys.Z]),this}})},6875:(t,e,i)=>{var n=i(1167);n.__keyboardStateTemplate={_keyDown:null,init:function(){this._keyDown={},this.triggerKeyEvent=this.triggerKeyEvent||this.trigger},isKeyDown:function(t){return"string"==typeof t&&(t=n.keys[t]),!!this._keyDown[t]},resetKeyDown:function(){var t={key:-1,eventName:"KeyUp"},e=this._keyDown;for(var i in e)!0===e[i]&&(t.key=+i,this.triggerKey("KeyUp",t));return this},triggerKey:function(t,e){var i=e.key;return"KeyDown"===t?!0!==this._keyDown[i]&&(this._keyDown[i]=!0,this.triggerKeyEvent(t,e)):"KeyUp"===t?!0===this._keyDown[i]&&(this._keyDown[i]=!1,this.triggerKeyEvent(t,e)):this.triggerKeyEvent(t,e),this}},n.c("KeyboardState",n.__keyboardStateTemplate),n.s("Keyboard",n.extend.call({triggerKeyEvent:function(t,e){n.trigger(t,e)}},n.__keyboardStateTemplate),{},!1)},6802:(t,e,i)=>{i(1167).extend({keys:{BACKSPACE:8,TAB:9,ENTER:13,PAUSE:19,CAPS:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,INSERT:45,DELETE:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBSTRACT:109,DECIMAL:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,SHIFT:16,CTRL:17,ALT:18,PLUS:187,COMMA:188,MINUS:189,PERIOD:190,PULT_UP:29460,PULT_DOWN:29461,PULT_LEFT:4,PULT_RIGHT:5},mouseButtons:{LEFT:0,MIDDLE:1,RIGHT:2}})},6521:(t,e,i)=>{var n=i(1167);n.__mouseStateTemplate={_buttonDown:null,lastMouseEvent:null,init:function(){this._buttonDown={},this.triggerMouseEvent=this.triggerMouseEvent||this.trigger,this.lastMouseEvent={eventName:"",mouseButton:-1,target:null,realX:0,realY:0,clientX:0,clientY:0,originalEvent:null}},isButtonDown:function(t){return"string"==typeof t&&(t=n.mouseButtons[t]),!!this._buttonDown[t]},resetButtonDown:function(){var t=this.lastMouseEvent,e=this._buttonDown;for(var i in e)!0===e[i]&&(t.mouseButton=+i,t.eventName="MouseUp",this.triggerMouse("MouseUp",t));return this},triggerMouse:function(t,e){var i=this.lastMouseEvent;i.eventName=t,i.mouseButton=e.mouseButton,i.target=e.target,i.realX=e.realX,i.realY=e.realY,i.clientX=e.clientX,i.clientY=e.clientY,i.originalEvent=e.originalEvent;var n=e.mouseButton;return"MouseDown"===t?!0!==this._buttonDown[n]&&(this._buttonDown[n]=!0,this.triggerMouseEvent(t,e)):"MouseUp"===t?!0===this._buttonDown[n]&&(this._buttonDown[n]=!1,this.triggerMouseEvent(t,e)):this.triggerMouseEvent(t,e),this}},n.c("MouseState",n.__mouseStateTemplate),n.s("Mouse",n.extend.call({triggerMouseEvent:function(t,e){n.trigger(t,e)}},n.__mouseStateTemplate),{},!1)},9663:(t,e,i)=>{var n=i(1167);n.__touchStateTemplate={touchPoints:null,_touchPointsPool:null,init:function(){this.touchPoints=[],this._touchPointsPool=[],this.triggerTouchEvent=this.triggerTouchEvent||this.trigger},resetTouchPoints:function(){for(var t,e=this.touchPoints,i=e.length;i--;)(t=e[i]).eventName="TouchCancel",this.triggerTouch("TouchCancel",t);return this},triggerTouch:function(t,e){switch(t){case"TouchStart":this._handleStart(e);break;case"TouchMove":this._handleMove(e);break;case"TouchCancel":case"TouchEnd":this._handleEnd(e);break;default:this.triggerTouchEvent(t,e)}return this},_indexOfTouchPoint:function(t){for(var e=this.touchPoints,i=0,n=e.length;i<n;i++)if(e[i].identifier===t)return i;return-1},_setTouchPoint:function(t,e){t.eventName=e.eventName,t.identifier=e.identifier,t.target=e.target,t.entity=e.entity,t.realX=e.realX,t.realY=e.realY,t.originalEvent=e.originalEvent},_handleStart:function(t){var e=this._indexOfTouchPoint(t.identifier);if(!(e>=0&&this.touchPoints[e])){var i=this._touchPointsPool.pop()||{};this._setTouchPoint(i,t),this.touchPoints.push(i),this.triggerTouchEvent(i.eventName,i)}},_handleMove:function(t){var e=this._indexOfTouchPoint(t.identifier),i=e>=0?this.touchPoints[e]:null;i&&(this._setTouchPoint(i,t),this.triggerTouchEvent(i.eventName,i))},_handleEnd:function(t){var e=this._indexOfTouchPoint(t.identifier),i=e>=0?this.touchPoints[e]:null;i&&(this._setTouchPoint(i,t),this.triggerTouchEvent(i.eventName,i),this.touchPoints.splice(e,1),i.target=null,i.entity=null,i.originalEvent=null,this._touchPointsPool.push(i))}},n.c("TouchState",n.__touchStateTemplate),n.s("Touch",n.extend.call({triggerTouchEvent:function(t,e){n.trigger(t,e)}},n.__touchStateTemplate),{},!1)},4881:(t,e,i)=>{var n=i(1167),r=function(t,e){this.timePerFrame=1e3/n.timer.FPS(),this.duration=t,"function"==typeof e?this.easing_function=e:"string"==typeof e&&this.standardEasingFunctions[e]?this.easing_function=this.standardEasingFunctions[e]:this.easing_function=this.standardEasingFunctions.linear,this.reset()};r.prototype={duration:0,clock:0,steps:null,complete:!1,paused:!1,reset:function(){this.loops=1,this.clock=0,this.complete=!1,this.paused=!1},repeat:function(t){this.loops=t},setProgress:function(t,e){this.clock=this.duration*t,void 0!==e&&(this.loops=e)},pause:function(){this.paused=!0},resume:function(){this.paused=!1,this.complete=!1},tick:function(t){if(!this.paused&&!this.complete)for(this.clock+=t,this.frames=Math.floor(this.clock/this.timePerFrame);this.clock>=this.duration&&!1===this.complete;)this.loops--,this.loops>0?this.clock-=this.duration:this.complete=!0},time:function(){return Math.min(this.clock/this.duration,1)},value:function(){return this.easing_function(this.time())},standardEasingFunctions:{linear:function(t){return t},smoothStep:function(t){return(3-2*t)*t*t},smootherStep:function(t){return(6*t*t-15*t+10)*t*t*t},easeInQuad:function(t){return t*t},easeOutQuad:function(t){return t*(2-t)},easeInOutQuad:function(t){return t<.5?2*t*t:(4-2*t)*t-1}}},t.exports=r},1167:(t,e,i)=>{var n,r,s,o,a,h,u,c,l,d,_=i(8241),p=function(t){return new p.fn.init(t)};o={},c=Array.prototype.slice,l=/\s*,\s*/,d=/\s+/;var f,g,v,y,m,w,x,b,M,T,D,C,E=function(){r=1,s=0,a={},u={},h={}};function R(){var t=r++;return t in a?R():t}E(),p.fn=p.prototype={init:function(t){if("string"!=typeof t)return t||(t=0)in a||(a[t]=this),t in a?(this[0]=t,this.length=1,this.__c||(this.__c={}),this._callbacks||p._addCallbackMethods(this),a[t]||(a[t]=this),a[t]):(this.length=0,this);var e,i,n,r,s,o,h,c,_,f=0,g=!1,v=!1;if("*"===t){for(e in c=0,a)this[c]=+e,c++;return this.length=c,1===c?a[this[0]]:this}if(-1!==t.indexOf(",")?(v=!0,i=l):-1!==t.indexOf(" ")&&(g=!0,i=d),v){for(r={},c=0,_=(n=t.split(i)).length;c<_;c++)for(h in s=u[n[c]])r[h]=+h;for(h in r)this[f++]=r[h]}else if(g){for(h in n=t.split(i),r={},s=u[n[0]],o=u[n[1]],s)void 0!==o[h]&&(r[h]=+h);for(c=2,_=n.length;c<_;c++)for(h in s=u[n[c]],r)void 0===s[h]&&(r[h]=-1);for(h in r)(c=r[h])>=0&&(this[f++]=c)}else for(h in s=u[t])this[f++]=+h;return this.length=f,1===f?a[this[f-1]]:(p._addCallbackMethods(this),this)},setName:function(t){var e=String(t);return this._entityName=e,this.trigger("NewEntityName",e),this},getName:function(t){return this._entityName},addComponent:function(t){var e,i,n,r=0;for(e=1===arguments.length&&-1!==t.indexOf(",")?t.split(l):arguments;r<e.length;r++)if(i=e[r],!0!==this.__c[i]){if(this.__c[i]=!0,(u[i]=u[i]||{})[this[0]]=this,n=o[i],this.extend(n),n&&"required"in n&&this.requires(n.required),n&&"properties"in n){var s=n.properties;for(var a in s)Object.defineProperty(this,a,s[a])}if(n&&"events"in n){var h=n.events;for(var c in h){var d="function"==typeof h[c]?h[c]:n[h[c]];this.bind(c,d)}}n&&"init"in n&&n.init.call(this)}return this.trigger("NewComponent",e),this},toggleComponent:function(t){var e,i,n=0;if(arguments.length>1)for(e=arguments.length;n<e;n++)this.has(arguments[n])?this.removeComponent(arguments[n]):this.addComponent(arguments[n]);else if(-1!==t.indexOf(","))for(e=(i=t.split(l)).length;n<e;n++)this.has(i[n])?this.removeComponent(i[n]):this.addComponent(i[n]);else this.has(t)?this.removeComponent(t):this.addComponent(t);return this},requires:function(){return this.addComponent.apply(this,arguments)},removeComponent:function(t,e){var i=o[t];if(this.trigger("RemoveComponent",t),i&&"events"in i){var n=i.events;for(var r in n){var s="function"==typeof n[r]?n[r]:i[n[r]];this.unbind(r,s)}}if(i&&"remove"in i&&i.remove.call(this,!1),!1===e&&i)for(var a in i)delete this[a];return delete this.__c[t],u[t]&&delete u[t][this[0]],this},getId:function(){return this[0]},has:function(t){return!!this.__c[t]},attr:function(t,e,i,n){return 1===arguments.length&&"string"==typeof arguments[0]?this._attr_get(t):this._attr_set(t,e,i,n)},_attr_get:function(t,e){var i,n;return null==e&&(e=this),t.indexOf(".")>-1?(i=(n=t.split(".")).shift(),n.join("."),this._attr_get(n.join("."),e[i])):e[t]},_attr_set:function(){var t,e,i;return"string"==typeof arguments[0]?(t=this._set_create_object(arguments[0],arguments[1]),e=!!arguments[2],i=arguments[3]||arguments[0].indexOf(".")>-1):(t=arguments[0],e=!!arguments[1],i=!!arguments[2]),e||this.trigger("Change",t),i?this._recursive_extend(t,this):this.extend.call(this,t),this},_set_create_object:function(t,e){var i,n,r,s={};return t.indexOf(".")>-1?(n=(i=t.split(".")).shift(),r=i.join("."),s[n]=this._set_create_object(r,e)):s[t]=e,s},_recursive_extend:function(t,e){var i;for(i in t)t[i].constructor===Object?e[i]=this._recursive_extend(t[i],e[i]):e[i]=t[i];return e},toArray:function(){return c.call(this,0)},timeout:function(t,e){return this.each((function(){var i=this;setTimeout((function(){t.call(i)}),e)})),this},bind:function(t,e){if(1===this.length)this._bindCallback(t,e);else for(var i=0;i<this.length;i++){var n=a[this[i]];n&&n._bindCallback(t,e)}return this},uniqueBind:function(t,e){this.unbind(t,e),this.bind(t,e)},one:function(t,e){var i=this,n=function(r){e.call(i,r),i.unbind(t,n)};return i.bind(t,n)},unbind:function(t,e){var i,n;for(i=0;i<this.length;i++)(n=a[this[i]])&&n._unbindCallbacks(t,e);return this},trigger:function(t,e){if(1===this.length)this._runCallbacks(t,e);else for(var i=0;i<this.length;i++){var n=a[this[i]];n&&n._runCallbacks(t,e)}return this},each:function(t){for(var e=0,i=this.length;e<i;e++)a[this[e]]&&t.call(a[this[e]],e);return this},get:function(t){var e=this.length;if(void 0!==t){if(t>=e||t+e<0)return;return t>=0?a[this[t]]:a[this[t+e]]}for(var i=0,n=[];i<e;i++)a[this[i]]&&n.push(a[this[i]]);return n},clone:function(){var t,e,i=this.__c,n=p.e();for(t in i)n.addComponent(t);for(e in this)"0"!==e&&"_global"!==e&&"_changed"!==e&&"function"!=typeof this[e]&&"object"!=typeof this[e]&&(n[e]=this[e]);return n},setter:function(t,e){return this.defineField(t,(function(){}),e)},defineField:function(t,e,i){return p.defineField(this,t,e,i),this},destroy:function(){this.each((function(){var t;for(var e in this.trigger("Remove"),this.__c)(t=o[e])&&"remove"in t&&t.remove.call(this,!0),delete u[e][this[0]];this._unbindAll(),delete a[this[0]]}))},freeze:function(){if(1!==this.length||this.__frozen)for(var t=0;t<this.length;t++){var e=a[this[t]];e&&!e.__frozen&&(e.trigger("Freeze",e),e._freezeCallbacks(),e.__frozen=!0)}else this.trigger("Freeze",this),this._freezeCallbacks(),this.__frozen=!0;return this},unfreeze:function(){if(1===this.length&&this.__frozen)this.__frozen=!1,this._unfreezeCallbacks(),this.trigger("Unfreeze",this);else for(var t=0;t<this.length;t++){var e=a[this[t]];e&&e.__frozen&&(e.__frozen=!1,e._unfreezeCallbacks(),e.trigger("Unfreeze",e))}return this}},p.fn.init.prototype=p.fn,p.extend=p.fn.extend=function(t){var e,i=this;if(!t)return i;for(e in t)i!==t[e]&&(i[e]=t[e]);return i},p._callbackMethods={_bindCallback:function(t,e){var i=this._callbacks[t];i||((i=this._callbacks[t]=(h[t]||(h[t]={}))[this[0]]=[]).context=this,i.depth=0),i.push(e)},_runCallbacks:function(t,e){if(this._callbacks[t]&&!this.__callbacksFrozen){var i,n=this._callbacks[t],r=n.length;for(n.depth++,i=0;i<r;i++)void 0===n[i]?n.depth<=1&&(n.splice(i,1),i--,r--,0===n.length&&(delete this._callbacks[t],delete h[t][this[0]])):n[i].call(this,e);n.depth--}},_unbindCallbacks:function(t,e){if(this._callbacks[t])for(var i=this._callbacks[t],n=0;n<i.length;n++)e&&i[n]!==e||delete i[n]},_unbindAll:function(){if(this._callbacks)for(var t in this.__callbacksFrozen=!1,this._callbacks)this._callbacks[t]&&(this._unbindCallbacks(t),delete h[t][this[0]])},_freezeCallbacks:function(){if(this._callbacks){for(var t in this._callbacks)this._callbacks[t]&&delete h[t][this[0]];this.__callbacksFrozen=!0}},_unfreezeCallbacks:function(){if(this._callbacks)for(var t in this.__callbacksFrozen=!1,this._callbacks)this._callbacks[t]&&(h[t][this[0]]=this._callbacks[t])}},p._addCallbackMethods=function(t){t.extend(p._callbackMethods),t._callbacks={}},p._addCallbackMethods(p),p.extend({0:"global",init:function(t,e,i){if(!this._preBindDone)for(var n=0;n<this._bindOnInit.length;n++){var r=this._bindOnInit[n];p.bind(r.event,r.handler)}return p.viewport.init(t,e,i),this.trigger("Load"),this.timer.init(),this},_bindOnInit:[],_preBindDone:!1,_preBind:function(t,e){this._bindOnInit.push({event:t,handler:e})},getVersion:function(){return _},stop:function(t){if(p.trigger("CraftyStop",t),this.timer.stop(),t){for(var e in p.audio.remove(),p._systems)p._systems[e].destroy();if(p.stage&&p.stage.elem.parentNode){var i=document.createElement("div");i.id=p.stage.elem.id,p.stage.elem.parentNode.replaceChild(i,p.stage.elem)}p._unbindAll(),p._addCallbackMethods(p),this._preBindDone=!1,E()}return this},pause:function(t){return(1===arguments.length?t:!this._paused)?(this.trigger("Pause"),this._paused=!0,setTimeout((function(){p.timer.stop()}),0)):(this.trigger("Unpause"),this._paused=!1,setTimeout((function(){p.timer.init()}),0)),this},isPaused:function(){return this._paused},timer:(w="fixed",x=5,b=40,M=0,T=0,D=50,C=1e3/D,{init:function(){void 0===m&&(m=Date.now()-C);var t="undefined"!=typeof window&&(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||null);t?(v=function(){p.timer.step(),null!==v&&(y=t(v))})():v=setInterval((function(){p.timer.step()}),1e3/D)},stop:function(){p.trigger("CraftyStopTimer"),"function"!=typeof v&&clearInterval(v);var t="undefined"!=typeof window&&(window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||null);t&&t(y),v=null},steptype:function(t,e){if("variable"===t||"semifixed"===t)w=t,e&&(b=e),p.trigger("NewSteptype",{mode:w,maxTimeStep:b});else{if("fixed"!==t){if(void 0!==t)throw"Invalid step type specified";return{mode:w,maxTimeStep:"variable"===w||"semifixed"===w?b:x}}w="fixed",e&&(x=e),p.trigger("NewSteptype",{mode:w,maxTimeStep:x})}},step:function(){var t,e,i,n=0,r=Date.now();if(M>0&&p.trigger("MeasureWaitTime",r-M),m+T>=r)M=r;else{var o=r-(m+T);o>20*C&&(T+=o-C,o=C),"fixed"===w?(n=Math.ceil(o/C),n=Math.min(n,x),e=C):"variable"===w?(n=1,e=o,e=Math.min(e,b)):"semifixed"===w&&(e=o/(n=Math.ceil(o/b)));for(var a=0;a<n;a++){i=r;var h={frame:s++,dt:e,gameTime:m};p.trigger("EnterFrame",h),p.trigger("UpdateFrame",h),p.trigger("ExitFrame",h),m+=e,r=Date.now(),p.trigger("MeasureFrameTime",r-i)}n>0&&(t=r,p.trigger("PreRender"),p.trigger("RenderScene"),p.trigger("PostRender"),r=Date.now(),p.trigger("MeasureRenderTime",r-t)),M=r}},FPS:function(t){if(void 0===t)return D;C=1e3/(D=t),p.trigger("FPSChange",t)},simulateFrames:function(t,e){for(e=e||C;t-- >0;){var i={frame:s++,dt:e};p.trigger("EnterFrame",i),p.trigger("UpdateFrame",i),p.trigger("ExitFrame",i)}p.trigger("PreRender"),p.trigger("RenderScene"),p.trigger("PostRender")}}),e:function(){var t=R();return a[t]=null,a[t]=p(t),arguments.length>0&&a[t].addComponent.apply(a[t],arguments),a[t].setName("Entity #"+t),a[t].addComponent("obj"),p.trigger("NewEntity",{id:t}),a[t]},c:function(t,e){o[t]=e},trigger:function(t,e){var i,n,r=h[t]||(h[t]={});for(i in r)r.hasOwnProperty(i)&&(n=r[i])&&0!==n.length&&n.context._runCallbacks(t,e)},bind:function(t,e){return this._bindCallback(t,e),e},uniqueBind:function(t,e){return this.unbind(t,e),this.bind(t,e)},one:function(t,e){var i=this,n=function(r){e.call(i,r),i.unbind(t,n)};return i.bind(t,n)},unbind:function(t,e){this._unbindCallbacks(t,e)},frame:function(){return s},entities:function(){return a},components:function(){return o},isComp:function(t){return t in o},debug:function(t){return"handlers"===t?h:a},settings:(f={},g={},{register:function(t,e){g[t]=e},modify:function(t,e){g[t]&&(g[t].call(f[t],e),f[t]=e)},get:function(t){return f[t]}}),defineField:function(t,e,i,n){Object.defineProperty(t,e,{get:i,set:n,configurable:!1,enumerable:!0})},clone:function t(e){if(null===e||"object"!=typeof e)return e;var i=e.constructor();for(var n in e)i[n]=t(e[n]);return i}}),void 0===(n=function(){return p}.apply(e,[]))||(t.exports=n),t.exports=p},5741:(t,e,i)=>{var n=i(1167),r="undefined"!=typeof window&&window.document;!function(){var t=n.support={},e="undefined"!=typeof navigator&&navigator.userAgent.toLowerCase()||"undefined"!=typeof process&&process.version,i=/(webkit)[ \/]([\w.]+)/.exec(e)||/(o)pera(?:.*version)?[ \/]([\w.]+)/.exec(e)||/(ms)ie ([\w.]+)/.exec(e)||/(moz)illa(?:.*? rv:([\w.]+))?/.exec(e)||/(v)\d+\.(\d+)/.exec(e)||[],s=/iPad|iPod|iPhone|Android|webOS|IEMobile/i.exec(e);if(s&&(n.mobile=s[0]),t.defineProperty=function(){if(!("defineProperty"in Object))return!1;try{Object.defineProperty({},"x",{})}catch(t){return!1}return!0}(),t.audio="undefined"!=typeof window&&"canPlayType"in r.createElement("audio"),t.prefix=i[1]||i[0],"moz"===t.prefix&&(t.prefix="Moz"),"o"===t.prefix&&(t.prefix="O"),"v"===t.prefix&&(t.prefix="node"),i[2]&&(t.versionName=i[2],t.version=+i[2].split(".")[0]),t.canvas="undefined"!=typeof window&&"getContext"in r.createElement("canvas"),t.canvas){var o;try{var a=r.createElement("canvas");(o=a.getContext("webgl")||a.getContext("experimental-webgl")).viewportWidth=t.canvas.width,o.viewportHeight=t.canvas.height}catch(t){}t.webgl=!!o}else t.webgl=!1;t.css3dtransform="undefined"!=typeof window&&(void 0!==r.createElement("div").style.Perspective||void 0!==r.createElement("div").style[t.prefix+"Perspective"]),t.deviceorientation="undefined"!=typeof window&&(void 0!==window.DeviceOrientationEvent||void 0!==window.OrientationEvent),t.devicemotion="undefined"!=typeof window&&void 0!==window.DeviceMotionEvent}()},9467:(t,e,i)=>{var n=i(1167);t.exports={assets:{},__paths:{audio:"",images:""},paths:function(t){if(void 0===t)return this.__paths;t.audio&&(this.__paths.audio=t.audio),t.images&&(this.__paths.images=t.images)},asset:function(t,e){return 1===arguments.length?n.assets[t]:n.assets[t]?void 0:(n.assets[t]=e,this.trigger("NewAsset",{key:t,value:e}),e)},imageWhitelist:["jpg","jpeg","gif","png","svg"],load:function(t,e,i,r){if(Array.isArray(t))n.log("Calling Crafty.load with an array of assets no longer works; see the docs for more details.");else{t="string"==typeof t?JSON.parse(t):t;var s,o,a,h,u,c,l=0,d=(t.audio?Object.keys(t.audio).length:0)+(t.images?Object.keys(t.images).length:0)+(t.sprites?Object.keys(t.sprites).length:0),_=n.paths(),p=function(t){return t.substr(t.lastIndexOf(".")+1).toLowerCase()},f=function(t,e){return-1===e.search("://")?"audio"===t?_.audio+e:_.images+e:e},g=function(t){return n.asset(t)||null},v=function(t){return n.support.audio&&n.audio.supports(p(t))},y=function(t,e){t.onload=x,"webkit"===n.support.prefix&&(t.src=""),t.src=e};for(h in t)for(u in t[h])if(t[h].hasOwnProperty(u)){if(s=t[h][u],a=null,"audio"===h){if("object"==typeof s){var m=[];for(var w in s)g(o=f(h,s[w]))||!v(s[w])||n.audio.sounds[u]||m.push(o);m.length>0&&(a=n.audio.add(u,m))}else"string"==typeof s&&(g(o=f(h,s))||!v(s)||n.audio.sounds[u]||(a=n.audio.add(u,o)));a&&(a=a.obj),a&&a.addEventListener&&a.addEventListener("canplaythrough",x,!1)}else g(o=f(h,u="sprites"===h?u:s))||(c=u,-1===n.imageWhitelist.indexOf(p(c)))||(a=new Image,"sprites"===h&&n.sprite(s.tile,s.tileh,o,s.map,s.paddingX,s.paddingY,s.paddingAroundBorder),n.asset(o,a),y(a,o));a?a.onerror=b:b.call({src:o})}0===d&&e&&e()}function x(){var t=this.src;this.removeEventListener&&this.removeEventListener("canplaythrough",x,!1),l++,i&&i({loaded:l,total:d,percent:l/d*100,src:t}),l===d&&e&&e()}function b(){var t=this.src;r&&r({loaded:l,total:d,percent:l/d*100,src:t}),++l===d&&e&&e()}},removeAssets:function(t){t="string"==typeof t?JSON.parse(t):t;var e,i,r,s,o=n.paths(),a=function(t,e){return-1===e.search("://")?"audio"===t?o.audio+e:o.images+e:e};for(r in t)for(s in t[r])if(t[r].hasOwnProperty(s))if(e=t[r][s],"audio"===r)if("object"==typeof e)for(var h in e)i=a(r,e[h]),n.asset(i)&&n.audio.remove(s);else"string"==typeof e&&(i=a(r,e),n.asset(i)&&n.audio.remove(s));else if(i=a(r,s="sprites"===r?s:e),n.asset(i)){if("sprites"===r)for(var u in e.map)delete n.components()[u];delete n.assets[i]}}}},4383:(t,e,i)=>{var n=i(1167);t.exports={init:function(){this.changed=[],this.bind("Change",this._changed_attributes),this.bind("Change",this._changed_triggers)},_changed_triggers:function(t,e){var i;for(i in e=n.extend.call({pre:""},e),t)this.trigger("Change["+e.pre+i+"]",t[i]),t[i].constructor===Object&&this._changed_triggers(t[i],{pre:e.pre+i+"."})},_changed_attributes:function(t){var e;for(e in t)this.changed.push(e);return this},is_dirty:function(t){return 0===arguments.length?!!this.changed.length:this.changed.indexOf(t)>-1}}},6106:(t,e,i)=>{var n=i(1167);t.exports={_scenes:{},_current:null,scene:function(t,e,i){1!==arguments.length&&"function"==typeof arguments[1]?n.defineScene(t,e,i):n.enterScene(t,arguments[1])},defineScene:function(t,e,i){if("function"!=typeof e)throw"Init function is the wrong type.";this._scenes[t]={},this._scenes[t].initialize=e,void 0!==i&&(this._scenes[t].uninitialize=i)},enterScene:function(t,e){if("function"==typeof e)throw"Scene data cannot be a function";n.trigger("SceneDestroy",{newScene:t}),n.viewport.reset(),n("2D").each((function(){this.has("Persist")||this.destroy()})),null!==this._current&&"uninitialize"in this._scenes[this._current]&&this._scenes[this._current].uninitialize.call(this);var i=this._current;this._current=t,n.trigger("SceneChange",{oldScene:i,newScene:t}),this._scenes.hasOwnProperty(t)?this._scenes[t].initialize.call(this,e):n.error('The scene "'+t+'" does not exist')}}},9705:(t,e,i)=>{var n=i(1167);let r=localStorage;var s=function(t,e){var i=e;if(!r)return n.error("Local storage is not accessible.  (Perhaps you are including crafty.js cross-domain?)"),!1;if(1===arguments.length)try{return JSON.parse(r.getItem(t))}catch(e){return r.getItem(t)}else"object"==typeof e&&(i=JSON.stringify(e)),r.setItem(t,i)};s.remove=function(t){r?r.removeItem(t):n.error("Local storage is not accessible.  (Perhaps you are including crafty.js cross-domain?)")},t.exports=s},8895:(t,e,i)=>{var n,r=i(1167);r._systems={},r.s=function(t,e,i,n){if(!e)return r._systems[t];"boolean"==typeof i&&(n=i,i=null),!1===n?(r._systems[t]=new r.CraftySystem(t,e,i),r.trigger("SystemLoaded",t)):r._registerLazySystem(t,e,i)},r._registerLazySystem=function(t,e,i){Object.defineProperty(r._systems,t,{get:function(){return Object.defineProperty(r._systems,t,{value:new r.CraftySystem(t,e,i),writable:!0,enumerable:!0,configurable:!0}),r.trigger("SystemLoaded",t),r._systems[t]},configurable:!0})},r.CraftySystem=(n=1,function(t,e,i){if(this.name=t,!e)return this;if(this._systemTemplate=e,this.extend(e),this.options=function(t,e){var i={};for(var n in e)i[n]=e[n];for(n in t)n in e||(i[n]=t[n]);return i}(this.options,i),r._addCallbackMethods(this),this[0]="system"+n++,"properties"in e){var s=e.properties;for(var o in s)Object.defineProperty(this,o,s[o])}if("events"in e){var a=e.events;for(var h in a){var u="function"==typeof a[h]?a[h]:e[a[h]];this.bind(h,u)}}"function"==typeof this.init&&this.init(t)}),r.CraftySystem.prototype={extend:function(t){for(var e in t)void 0===this[e]&&(this[e]=t[e])},bind:function(t,e){return this._bindCallback(t,e),this},trigger:function(t,e){return this._runCallbacks(t,e),this},unbind:function(t,e){return this._unbindCallbacks(t,e),this},one:function(t,e){var i=this,n=function(r){e.call(i,r),i.unbind(t,n)};return i.bind(t,n)},uniqueBind:function(t,e){return this.unbind(t,e),this.bind(t,e)},destroy:function(){r.trigger("SystemDestroyed",this),"function"==typeof this.remove&&this.remove(),this._unbindAll(),delete r._systems[this.name]}}},709:t=>{t.exports={delaySpeed:1,init:function(){this._delays=[],this._delaysPaused=!1,this.bind("UpdateFrame",(function(t){if(!this._delaysPaused)for(var e=this._delays.length;--e>=0;){var i=this._delays[e];if(!1===i)this._delays.splice(e,1);else{for(i.accumulator+=t.dt*this.delaySpeed;i.accumulator>=i.delay&&i.repeat>=0;)i.accumulator-=i.delay,i.repeat--,i.callback.call(this);i.repeat<0&&(this._delays.splice(e,1),"function"==typeof i.callbackOff&&i.callbackOff.call(this))}}}))},delay:function(t,e,i,n){return this._delays.push({accumulator:0,callback:t,callbackOff:n,delay:e,repeat:(i<0?1/0:i)||0}),this},cancelDelay:function(t){for(var e=this._delays.length;--e>=0;){var i=this._delays[e];i&&i.callback===t&&(this._delays[e]=!1)}return this},pauseDelays:function(){this._delaysPaused=!0},resumeDelays:function(){this._delaysPaused=!1}}},5398:(t,e,i)=>{var n=i(1167);t.exports={tweenSpeed:1,init:function(){this.tweenGroup={},this.tweenStart={},this.tweens=[],this.uniqueBind("UpdateFrame",this._tweenTick)},_tweenTick:function(t){var e,i,n;for(n=this.tweens.length-1;n>=0;n--)(e=this.tweens[n]).easing.tick(t.dt*this.tweenSpeed),i=e.easing.value(),this._doTween(e.props,i),e.easing.complete&&(this.tweens.splice(n,1),this._endTween(e.props))},_doTween:function(t,e){for(var i in t)this[i]=(1-e)*this.tweenStart[i]+e*t[i]},tween:function(t,e,i){var r={props:t,easing:new n.easing(e,i)};for(var s in t)void 0!==this.tweenGroup[s]&&this.cancelTween(s),this.tweenStart[s]=this[s],this.tweenGroup[s]=t;return this.tweens.push(r),this},cancelTween:function(t){if("string"==typeof t)"object"==typeof this.tweenGroup[t]&&delete this.tweenGroup[t][t];else if("object"==typeof t)for(var e in t)this.cancelTween(e);return this},pauseTweens:function(){this.tweens.map((function(t){t.easing.pause()}))},resumeTweens:function(){this.tweens.map((function(t){t.easing.resume()}))},_endTween:function(t){var e=!1;for(var i in t)e=!0,delete this.tweenGroup[i];e&&this.trigger("TweenEnd",t)}}},8241:t=>{t.exports="3"},956:(t,e,i)=>{t.exports=function(t){var e=i(1167);i(5741),e.easing=i(4881),e.c("Model",i(4383)),e.extend(i(6106)),e.storage=i(9705),e.c("Delay",i(709)),e.c("Tween",i(5398));var n=i(4851);return e.HashMap=n,e.map=new n,i(8895),i(9600),i(8087),i(2377),i(8688),i(2609),i(9689),i(3654),i(1593),i(6875),i(6802),i(6521),i(9663),i(657),e}},6717:(t,e,i)=>{var n=i(1167),r=window.document;n.c("DebugCanvas",{init:function(){this.requires("2D"),n.DebugCanvas.context||n.DebugCanvas.init(),n.DebugCanvas.add(this),this._debug={alpha:1,lineWidth:1},this.bind("RemoveComponent",this.onDebugRemove),this.bind("Remove",this.onDebugDestroy)},onDebugRemove:function(t){"DebugCanvas"===t&&n.DebugCanvas.remove(this)},onDebugDestroy:function(t){n.DebugCanvas.remove(this)},debugAlpha:function(t){return this._debug.alpha=t,this},debugFill:function(t){return void 0===t&&(t="red"),this._debug.fillStyle=t,this},debugStroke:function(t){return void 0===t&&(t="red"),this._debug.strokeStyle=t,this},debugDraw:function(t){var e=t.globalAlpha,i=this._debug;i.alpha&&(t.globalAlpha=this._debug.alpha),i.strokeStyle&&(t.strokeStyle=i.strokeStyle),i.lineWidth&&(t.lineWidth=i.lineWidth),i.fillStyle&&(t.fillStyle=i.fillStyle),this.trigger("DebugDraw",t),t.globalAlpha=e}}),n.c("DebugRectangle",{init:function(){this.requires("2D, DebugCanvas")},debugRectangle:function(t){return this.debugRect=t,this.unbind("DebugDraw",this.drawDebugRect),this.bind("DebugDraw",this.drawDebugRect),this},drawDebugRect:function(t){var e=this.debugRect;null!=e&&e._h&&e._w&&(this._debug.fillStyle&&t.fillRect(e._x,e._y,e._w,e._h),this._debug.strokeStyle&&t.strokeRect(e._x,e._y,e._w,e._h))}}),n.c("WiredMBR",{init:function(){this.requires("DebugRectangle").debugStroke("purple")},events:{PreRender:function(){this.debugRectangle(this._mbr||this)}}});var s={init:function(){this.requires("DebugRectangle").debugFill("pink")},events:{PreRender:function(){this.debugRectangle(this._mbr||this)}}};n.c("SolidMBR",s),n.c("VisibleMBR",s),n.c("DebugPolygon",{init:function(){this.requires("2D, DebugCanvas")},debugPolygon:function(t){return this.polygon=t,this.unbind("DebugDraw",this.drawDebugPolygon),this.bind("DebugDraw",this.drawDebugPolygon),this},drawDebugPolygon:function(t){if(void 0!==this.polygon){t.beginPath();for(var e=this.polygon.points,i=e.length,n=0;n<i;n+=2)t.lineTo(e[n],e[n+1]);t.closePath(),this._debug.fillStyle&&t.fill(),this._debug.strokeStyle&&t.stroke()}}}),n.c("WiredHitBox",{init:function(){this.requires("DebugPolygon").debugStroke("red").matchHitBox(),this.bind("NewHitbox",this.matchHitBox)},matchHitBox:function(){this.debugPolygon(this.map)}}),n.c("SolidHitBox",{init:function(){this.requires("Collision, DebugPolygon").debugFill("orange").debugAlpha(.7).matchHitBox(),this.bind("NewHitbox",this.matchHitBox)},matchHitBox:function(){this.debugPolygon(this.map)}}),n.c("WiredAreaMap",{init:function(){this.requires("DebugPolygon").debugStroke("green").matchAreaMap(),this.bind("NewAreaMap",this.matchAreaMap)},matchAreaMap:function(){this.debugPolygon(this.mapArea)}}),n.c("SolidAreaMap",{init:function(){this.requires("DebugPolygon").debugFill("lime").debugAlpha(.7).matchAreaMap(),this.bind("NewAreaMap",this.matchAreaMap)},matchAreaMap:function(){this.debugPolygon(this.mapArea)}}),n.DebugCanvas={context:null,entities:[],onetimeEntities:[],add:function(t){this.entities.push(t)},remove:function(t){for(var e=this.entities,i=e.length-1;i>=0;i--)e[i]===t&&e.splice(i,1)},init:function(){if(!n.DebugCanvas.context){if(!n.support.canvas)return n.trigger("NoCanvas"),void n.stop();var t;(t=r.createElement("canvas")).width=n.viewport.width,t.height=n.viewport.height,t.style.position="absolute",t.style.left="0px",t.style.top="0px",t.id="debug-canvas",t.style.zIndex=1e5,n.stage.elem.appendChild(t),n.DebugCanvas.context=t.getContext("2d"),n.DebugCanvas._canvas=t}n.unbind("RenderScene",n.DebugCanvas.renderScene),n.bind("RenderScene",n.DebugCanvas.renderScene)},renderScene:function(t){t=t||n.viewport.rect();var e,i=n.DebugCanvas.entities,r=0,s=i.length,o=n.DebugCanvas.context,a=n.viewport;o.setTransform(a._scale,0,0,a._scale,Math.round(a._x*a._scale),Math.round(a._y*a._scale)),o.clearRect(t._x,t._y,t._w,t._h);for(var h=null;r<s;r++)h!==(e=i[r])._drawLayer&&(e._drawLayer?(a=e._drawLayer._viewportRect(),o.setTransform(a._scale,0,0,a._scale,Math.round(-a._x*a._scale),Math.round(-a._y*a._scale))):(a=n.viewport,o.setTransform(a._scale,0,0,a._scale,Math.round(a._x*a._scale),Math.round(a._y*a._scale))),h=e._drawLayer),e.debugDraw(o)}}},657:(t,e,i)=>{var n=i(1167);n.extend({loggingEnabled:!0,log:function(){n.loggingEnabled&&("undefined"!=typeof window?window.console:console)&&console.log&&console.log.apply(console,arguments)},error:function(){n.loggingEnabled&&("undefined"!=typeof window?window.console:console)&&console.error&&console.error.apply(console,arguments)}})},9659:(t,e,i)=>{var n=i(1167);n._registerLayerTemplate("Canvas",{type:"Canvas",layerCount:0,_changedObjs:null,_dirtyRects:null,_dirtyCells:null,_viewKeys:null,__tempRect:null,__tempSearchRect:null,__tempScreenRect:null,dirty:function(t){this._changedObjs.push(t)},attach:function(t){t._drawContext=this.context,this.layerCount++},detach:function(t){this.dirty(t),t._drawContext=null,this.layerCount--},context:null,_canvas:null,events:{LayerInit:"layerInit",LayerRemove:"layerRemove",RenderScene:"_render",PixelartSet:"_setPixelart",ViewportResize:"_resize"},layerInit:function(){if(!n.support.canvas)return n.trigger("NoCanvas"),void n.stop();var t;this._changedObjs=[],this._dirtyRects=[],this._dirtyCells={},this._viewKeys={x1:0,y1:0,x2:0,y2:0},this.__tempRect={_x:0,_y:0,_w:0,_h:0},this.__tempSearchRect={_x:0,_y:0,_w:0,_h:0},this.__tempScreenRect={_x:0,_y:0,_w:0,_h:0},(t=document.createElement("canvas")).width=n.viewport.width,t.height=n.viewport.height,t.style.position="absolute",t.style.left="0px",t.style.top="0px",t.style.zIndex=this.options.z,n.stage.elem.appendChild(t),this.context=t.getContext("2d"),this._canvas=t;var e=n.viewport._scale;1!==e&&this.context.scale(e,e)},layerRemove:function(){this._canvas.parentNode.removeChild(this._canvas)},_render:function(){var t=this._dirtyViewport,e=this._changedObjs.length,i=this.context;if(e||t){var n=this.options;if(t&&n){var r=this._viewportRect(),s=r._scale,o=-r._x*s,a=-r._y*s;i.setTransform(s,0,0,s,Math.round(o),Math.round(a))}e/this.layerCount>.6||t?this._drawAll():this._drawDirtyCells(),this._clean()}},_drawDirtyCells:function(t){var e,i,r=this._viewportRect(),s=this.__tempRect,o=this._dirtyRects,a=n.rectManager.integerBounds,h=this.context;for(t=a(t||r),this._createDirtyCells(t),this._createDirtyRects(),e=0,i=o.length;e<i;e+=4)s._x=o[e+0],s._y=o[e+1],s._w=o[e+2],s._h=o[e+3],this._drawRect(s);if(!0===this.debugDirty){var u=n.frame(),c=(6*u+0)%255,l=(6*u+85)%255,d=(6*u+170)%255;for(h.strokeStyle="rgb("+c+", "+l+", "+d+")",e=0,i=o.length;e<i;e+=4)h.strokeRect(o[e+0],o[e+1],o[e+2],o[e+3])}},_drawAll:function(t){var e=this._viewportRect();this._drawRect(t||e)},_drawRect:function(t){var e,i,r,s,o,a=n.rectManager.integerBounds,h=this.context,u=this.__tempSearchRect,c=this.__tempScreenRect;for(c=a(c=this._viewTransformRect(t,c,!0)),t=a(t),u._x=t._x,u._y=t._y,u._w=t._w-1,u._h=t._h-1,(r=n.map.search(u)).sort(this._sort),h.save(),h.save(),h.setTransform(1,0,0,1,0,0),h.beginPath(),h.rect(c._x,c._y,c._w,c._h),h.clearRect(c._x,c._y,c._w,c._h),h.restore(),h.clip(),o=-1/0,e=0,i=r.length;e<i;++e)(s=r[e])._globalZ>o&&s._visible&&s._drawLayer===this&&(s.draw(h),s._changed=!1,o=s._globalZ);h.restore()},debug:function(){n.log(this._changedObjs)},_clean:function(){var t,e,i,n,r,s=this._changedObjs;for(n=0,r=s.length;n<r;n++)t=(i=s[n])._entry.keys,void 0===(e=i.staleKeys)&&(i.staleKeys=e={x1:0,y1:0,x2:0,y2:0}),e.x1=t.x1,e.y1=t.y1,e.x2=t.x2,e.y2=t.y2,i._changed=!1;s.length=0,this._dirtyCells={},this._dirtyRects.length=0,this._dirtyViewport=!1},_createDirtyCells:function(t){var e,i,r,s,o,a,h=this._changedObjs,u=this._dirtyCells,c=n.HashMap.key(t,this._viewKeys);for(e=0,i=h.length;e<i;e++){if(a=(o=h[e]).staleKeys)for(r=a.x1;r<=a.x2;r++)for(s=a.y1;s<=a.y2;s++)c.x1<=r&&r<=c.x2&&c.y1<=s&&s<=c.y2&&(u[r<<16^s]=!0);for(r=(a=o._entry.keys).x1;r<=a.x2;r++)for(s=a.y1;s<=a.y2;s++)c.x1<=r&&r<=c.x2&&c.y1<=s&&s<=c.y2&&(u[r<<16^s]=!0)}},_createDirtyRects:function(){var t,e,i,r=n.HashMap.cellsize(),s=this._dirtyCells,o=this._dirtyRects;for(var a in s)e=(i=(t=+a)<<16>>16)<0?~(t>>16):t>>16,o.push(e*r,i*r,r,r)},_resize:function(){var t=this._canvas;t.width=n.viewport.width,t.height=n.viewport.height},_setPixelart:function(t){var e=this.context;e.imageSmoothingEnabled=!t,e.mozImageSmoothingEnabled=!t,e.webkitImageSmoothingEnabled=!t,e.oImageSmoothingEnabled=!t,e.msImageSmoothingEnabled=!t}})},6013:(t,e,i)=>{var n=i(1167);n.c("Canvas",{init:function(){this.requires("Renderable"),this.currentRect={},this._customLayer||this._attachToLayer(n.s("DefaultCanvasLayer"))},remove:function(){this._detachFromLayer()},drawVars:{type:"canvas",pos:{},ctx:null,coord:[0,0,0,0],co:{x:0,y:0,w:0,h:0}},draw:function(t,e,i,n,r){if(this.ready){var s=this.drawVars.pos;s._x=this._x+(e||0),s._y=this._y+(i||0),s._w=n||this._w,s._h=r||this._h;var o,a=t||this._drawContext,h=this.__coord||[0,0,0,0],u=this.drawVars.co;return u.x=h[0]+(e||0),u.y=h[1]+(i||0),u.w=n||h[2],u.h=r||h[3],(this._flipX||this._flipY||this._rotation)&&a.save(),0!==this._rotation&&(a.translate(this._origin.x+this._x,this._origin.y+this._y),s._x=-this._origin.x,s._y=-this._origin.y,a.rotate(this._rotation%360*(Math.PI/180))),(this._flipX||this._flipY)&&(a.scale(this._flipX?-1:1,this._flipY?-1:1),this._flipX&&(s._x=-(s._x+s._w)),this._flipY&&(s._y=-(s._y+s._h))),this._alpha<1&&(o=a.globalAlpha,a.globalAlpha=this._alpha),this.drawVars.ctx=a,this.trigger("Draw",this.drawVars),(0!==this._rotation||this._flipX||this._flipY)&&a.restore(),o&&(a.globalAlpha=o),this}}})},7132:(t,e,i)=>{var n=i(1167),r=window.document;n.extend({assignColor:function(){var t=r.createElement("div");t.style.display="none";var e=!1,i={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#00ff00",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#ffa500",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00"};function n(t){return t._red=t._blue=t._green=0,t}function s(t){var e=t.toString(16);return 1===e.length&&(e="0"+e),e}function o(t,e){var i,r,s,o=t.length;if(7===o)i=t.substr(1,2),r=t.substr(3,2),s=t.substr(5,2);else{if(4!==o)return n(e);i=t.substr(1,1),i+=i,r=t.substr(2,1),r+=r,s=t.substr(3,1),s+=s}return e._red=parseInt(i,16),e._green=parseInt(r,16),e._blue=parseInt(s,16),e}var a=/rgba?\s*\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,?\s*([0-9.]+)?\)/;function h(t,e){var i=a.exec(t);return null===i||4!==i.length&&5!==i.length?n(e):(e._red=Math.round(parseFloat(i[1])),e._green=Math.round(parseFloat(i[2])),e._blue=Math.round(parseFloat(i[3])),i[4]&&(e._strength=parseFloat(i[4])),e)}return function(n,r){r=r||{},"#"===(n=n.trim().toLowerCase())[0]?o(n,r):"r"===n[0]&&"g"===n[1]&&"b"===n[2]?h(n,r):function(n,r){var a,u,c;void 0===i[n]?(!1===e&&(window.document.body.appendChild(t),e=!0),t.style.color=n,h(window.getComputedStyle(t).color,r),i[n]=(a=r._red,u=r._green,c=r._blue,"#"+s(a)+s(u)+s(c))):o(i[n],r)}(n,r),r._strength=r._strength||1,r._color=function(t){return"rgba("+t._red+", "+t._green+", "+t._blue+", "+t._strength+")"}(r)}}()}),n.defaultShader("Color",new n.WebGLShader("attribute vec2 aPosition;\nattribute vec3 aOrientation;\nattribute vec2 aLayer;\nattribute vec4 aColor;\n\nvarying lowp vec4 vColor;\n\nuniform  vec4 uViewport;\n\nmat4 viewportScale = mat4(2.0 / uViewport.z, 0, 0, 0,    0, -2.0 / uViewport.w, 0,0,    0, 0,1,0,    -1,+1,0,1);\nvec4 viewportTranslation = vec4(uViewport.xy, 0, 0);\n\nvoid main() {\n  vec2 pos = aPosition;\n  vec2 entityOrigin = aOrientation.xy;\n  mat2 entityRotationMatrix = mat2(cos(aOrientation.z), sin(aOrientation.z), -sin(aOrientation.z), cos(aOrientation.z));\n\n  pos = entityRotationMatrix * (pos - entityOrigin) + entityOrigin;\n  gl_Position = viewportScale * (viewportTranslation + vec4(pos, 1.0/(1.0+exp(aLayer.x) ), 1) );\n  vColor = vec4(aColor.rgb*aColor.a*aLayer.y, aColor.a*aLayer.y);\n}","precision mediump float;\nvarying lowp vec4 vColor;\nvoid main(void) {\n\tgl_FragColor = vColor;\n}",[{name:"aPosition",width:2},{name:"aOrientation",width:3},{name:"aLayer",width:2},{name:"aColor",width:4}],(function(t,e){t.program.writeVector("aColor",e._red/255,e._green/255,e._blue/255,e._strength)}))),n.c("Color",{_red:0,_green:0,_blue:0,_strength:1,_color:"",ready:!0,init:function(){this.__coord=this.__coord||[0,0,0,0],this.bind("Draw",this._drawColor),this._drawLayer&&this._setupColor(this._drawLayer),this.trigger("Invalidate")},events:{LayerAttached:"_setupColor"},remove:function(){this.unbind("Draw",this._drawColor),this.has("DOM")&&(this._element.style.backgroundColor="transparent"),this.trigger("Invalidate")},_setupColor:function(t){"WebGL"===t.type&&this._establishShader("Color",n.defaultShader("Color"))},_drawColor:function(t){this._color&&("DOM"===t.type?(t.style.backgroundColor=this._color,t.style.lineHeight=0):"canvas"===t.type?(t.ctx.fillStyle=this._color,t.ctx.fillRect(t.pos._x,t.pos._y,t.pos._w,t.pos._h)):"webgl"===t.type&&t.program.draw(t,this))},color:function(t){return 0===arguments.length?this._color:(arguments.length>=3?(this._red=arguments[0],this._green=arguments[1],this._blue=arguments[2],"number"==typeof arguments[3]&&(this._strength=arguments[3])):(n.assignColor(t,this),"number"==typeof arguments[1]&&(this._strength=arguments[1])),this._color="rgba("+this._red+", "+this._green+", "+this._blue+", "+this._strength+")",this.trigger("Invalidate"),this)}})},5425:(t,e,i)=>{var n=i(1167),r=window.document;n.extend({domHelper:{innerPosition:function(t,e){e=e||{};var i=t.getBoundingClientRect(),n=i.left+(window.pageXOffset?window.pageXOffset:r.body.scrollLeft),s=i.top+(window.pageYOffset?window.pageYOffset:r.body.scrollTop),o=parseInt(this.getStyle(t,"border-left-width")||0,10)||parseInt(this.getStyle(t,"borderLeftWidth")||0,10)||0,a=parseInt(this.getStyle(t,"border-top-width")||0,10)||parseInt(this.getStyle(t,"borderTopWidth")||0,10)||0;return e.x=n+o,e.y=s+a,e},getStyle:function(t,e){var i;return t.currentStyle?i=t.currentStyle[this.camelize(e)]:window.getComputedStyle&&(i=r.defaultView.getComputedStyle(t,null).getPropertyValue(this.csselize(e))),i},camelize:function(t){return t.replace(/-+(.)?/g,(function(t,e){return e?e.toUpperCase():""}))},csselize:function(t){return t.replace(/[A-Z]/g,(function(t){return t?"-"+t.toLowerCase():""}))},translate:function(t,e,i,s){s=s||{};var o,a=r.documentElement,h=r.body;return i?(o=i._viewportRect(),s.x=(t-n.stage.x+(a&&a.scrollLeft||h&&h.scrollLeft||0))/o._scale+o._x,s.y=(e-n.stage.y+(a&&a.scrollTop||h&&h.scrollTop||0))/o._scale+o._y):(o=n.viewport,s.x=(t-n.stage.x+(a&&a.scrollLeft||h&&h.scrollLeft||0))/o._scale-o._x,s.y=(e-n.stage.y+(a&&a.scrollTop||h&&h.scrollTop||0))/o._scale-o._y),s}}})},279:(t,e,i)=>{var n=i(1167),r=window.document;n._registerLayerTemplate("DOM",{type:"DOM",_changedObjs:[],_div:null,events:{LayerInit:"layerInit",LayerRemove:"layerRemove",RenderScene:"_render",PixelartSet:"_setPixelart"},layerInit:function(){this._changedObjs=[];var t=this._div=r.createElement("div");n.stage.elem.appendChild(t),t.style.position="absolute",t.style.zIndex=this.options.z,t.style.transformStyle="preserve-3d"},layerRemove:function(){this._div.parentNode.removeChild(this._div)},_setPixelArt:function(t){var e=this._div.style,i=n.domHelper.camelize;t?(e[i("image-rendering")]="optimizeSpeed",e[i("image-rendering")]="-moz-crisp-edges",e[i("image-rendering")]="-o-crisp-edges",e[i("image-rendering")]="-webkit-optimize-contrast",e[i("-ms-interpolation-mode")]="nearest-neighbor",e[i("image-rendering")]="optimize-contrast",e[i("image-rendering")]="pixelated",e[i("image-rendering")]="crisp-edges"):(e[i("image-rendering")]="optimizeQuality",e[i("-ms-interpolation-mode")]="bicubic",e[i("image-rendering")]="auto")},debug:function(){n.log(this._changedObjs)},_render:function(){var t=this._changedObjs;if(this._dirtyViewport&&(this._setViewport(),this._dirtyViewport=!1),t.length){for(var e=0,i=t.length;e<i;++e)t[e].draw()._changed=!1;t.length=0}},dirty:function(t){this._changedObjs.push(t)},attach:function(t){t._drawContext=this.context,this._div.appendChild(t._element),t._element.style.position="absolute",t._element.id="ent"+t[0]},detach:function(t){this._div.removeChild(t._element)},_setViewport:function(){var t=this._div.style,e=this._viewportRect(),i=e._scale,r=-e._x*i,s=-e._y*i;t.transform=t[n.support.prefix+"Transform"]="scale("+i+", "+i+")",t.left=Math.round(r)+"px",t.top=Math.round(s)+"px",t.zIndex=this.options.z}})},9660:(t,e,i)=>{var n=i(1167),r=window.document;n.c("DOM",{_element:null,_cssStyles:null,avoidCss3dTransforms:!1,init:function(){this.requires("Renderable"),this._cssStyles={visibility:"",left:"",top:"",width:"",height:"",zIndex:"",opacity:"",transformOrigin:"",transform:""},this._element=r.createElement("div"),this._customLayer||this._attachToLayer(n.s("DefaultDOMLayer")),this.bind("NewComponent",this._updateClass),this.bind("RemoveComponent",this._removeClass)},remove:function(){this._detachFromLayer(),this.unbind("NewComponent",this._updateClass),this.unbind("RemoveComponent",this._removeClass)},getDomId:function(){return this._element.id},_removeClass:function(t){var e,i=this.__c,n="";for(e in i)e!==t&&(n+=" "+e);n=n.substr(1),this._element.className=n},_updateClass:function(){var t,e=this.__c,i="";for(t in e)i+=" "+t;i=i.substr(1),this._element.className=i},DOM:function(t){if(t&&t.nodeType){var e=this._drawLayer;this._detachFromLayer(),this._element=t,this._attachToLayer(e)}return this},draw:function(){var t=this._element.style,e=this.__coord||[0,0,0,0],i={x:e[0],y:e[1],w:e[2],h:e[3]},r=n.support.prefix,s=[];if(this._cssStyles.visibility!==this._visible&&(this._cssStyles.visibility=this._visible,this._visible?t.visibility="visible":t.visibility="hidden"),n.support.css3dtransform&&!this.avoidCss3dTransforms?s.push("translate3d("+~~this._x+"px,"+~~this._y+"px,0)"):(this._cssStyles.left!==this._x&&(this._cssStyles.left=this._x,t.left=~~this._x+"px"),this._cssStyles.top!==this._y&&(this._cssStyles.top=this._y,t.top=~~this._y+"px")),this._cssStyles.width!==this._w&&(this._cssStyles.width=this._w,t.width=~~this._w+"px"),this._cssStyles.height!==this._h&&(this._cssStyles.height=this._h,t.height=~~this._h+"px"),this._cssStyles.zIndex!==this._z&&(this._cssStyles.zIndex=this._z,t.zIndex=this._z),this._cssStyles.opacity!==this._alpha&&(this._cssStyles.opacity=this._alpha,t.opacity=this._alpha,t[r+"Opacity"]=this._alpha),this._mbr){var o=this._origin.x+"px "+this._origin.y+"px";t.transformOrigin=o,t[r+"TransformOrigin"]=o,n.support.css3dtransform?s.push("rotateZ("+this._rotation+"deg)"):s.push("rotate("+this._rotation+"deg)")}return this._flipX&&s.push("scaleX(-1)"),this._flipY&&s.push("scaleY(-1)"),this._cssStyles.transform!==s.join(" ")&&(this._cssStyles.transform=s.join(" "),t.transform=this._cssStyles.transform,t[r+"Transform"]=this._cssStyles.transform),this.trigger("Draw",{style:t,type:"DOM",co:i}),this},_setCssProperty:function(t,e,i){"number"==typeof i&&(i+="px"),t[e=n.domHelper.camelize(e)]=i,this.trigger("SetStyle",e)},css:function(t,e){var i,r,s=this._element,o=s.style;if("object"==typeof t)for(i in t)t.hasOwnProperty(i)&&(r=t[i],this._setCssProperty(o,i,r));else{if(!e)return n.domHelper.getStyle(s,t);this._setCssProperty(o,t,e)}return this.trigger("Invalidate"),this}})},8739:(t,e,i)=>{var n=i(1167);n.extend({background:function(t){n.stage.elem.style.background=t},_pixelartEnabled:!1,pixelart:function(t){n._pixelartEnabled=t,n.trigger("PixelartSet",t)}})},6867:(t,e,i)=>{var n=i(1167);function r(t,e){this.gl=t,this.webgl=e,this.max_units=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this.bound_textures=[],this.registered_textures={},this.active=null}function s(t,e){this.manager=t,this.gl=t.gl,this.glTexture=this.gl.createTexture(),this.id=e,this.active=!1,this.unit=null,this.powerOfTwo=!1}n.TextureManager=r,r.prototype={reset:function(){for(var t=0;t<this.bound_textures.length;t++)this.bound_textures[t].unbind();this.bound_textures=[],this.active=null},makeTexture:function(t,e,i){var n=this.webgl,r="texture-(r:"+i+")-"+t;if(void 0!==this.registered_textures[r])return this.registered_textures[r];var o=new s(this,r);return this.registered_textures[r]=o,this.bindTexture(o),o.setImage(e),o.setFilter(n.texture_filter),o.setRepeat(i),o},smallest:function(){for(var t=1/0,e=null,i=0;i<this.bound_textures.length;i++){var n=this.bound_textures[i];n.size<t&&(t=n.size,e=i)}return e},getAvailableUnit:function(){return this.bound_textures.length<this.max_units?this.bound_textures.length:this.smallest()},bindTexture:function(t){if(null===t.unit){var e=this.getAvailableUnit();this.bound_textures[e]&&this.unbindTexture(this.bound_textures[e]),this.bound_textures[e]=t,t.bind(e)}},unbindTexture:function(t){t.unbind()},setActiveTexture:function(t){this.active!==t.id&&(this.gl.activeTexture(this.gl[t.name]),this.active=t.unit)}},n.TextureWrapper=s,s.prototype={bind:function(t){var e=this.gl;this.unit=t,this.name="TEXTURE"+t,this.manager.setActiveTexture(this),e.bindTexture(e.TEXTURE_2D,this.glTexture)},isActive:function(){return this.manager.active===this.unit},unbind:function(){this.unit=null,this.name=null,this.isActive()&&(this.manager.active=null)},setImage:function(t){if(!this.isActive())throw"Trying to set image of texture that isn't active";this.width=t.width,this.height=t.height,this.size=t.width*t.height,this.powerOfTwo=!(Math.log(t.width)/Math.LN2!==Math.floor(Math.log(t.width)/Math.LN2)||Math.log(t.height)/Math.LN2!==Math.floor(Math.log(t.height)/Math.LN2));var e=this.gl;e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t)},setFilter:function(t){if(!this.isActive())throw"Trying to set filter of texture that isn't active";var e=this.gl;e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t)},setRepeat:function(t){if(!this.isActive())throw"Trying to set repeat property of texture that isn't active";if(t&&!this.powerOfTwo)throw"Can't create a repeating image whose dimensions aren't a power of 2 in WebGL contexts";var e=this.gl;this.repeatMode=t?e.REPEAT:e.CLAMP_TO_EDGE,e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,this.repeatMode),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,this.repeatMode)},setToProgram:function(t,e,i){if(null===this.unit)throw"Trying to use texture not set to a texture unit.";var n=this.gl;n.useProgram(t),n.uniform1i(n.getUniformLocation(t,e),this.unit),n.uniform2f(n.getUniformLocation(t,i),this.width,this.height)}}},4876:(t,e,i)=>{i(1167).c("HTML",{inner:"",init:function(){this.requires("2D, DOM")},replace:function(t){return this.inner=t,this._element.innerHTML=t,this},append:function(t){return this.inner+=t,this._element.innerHTML+=t,this},prepend:function(t){return this.inner=t+this.inner,this._element.innerHTML=t+this.inner,this}})},1097:(t,e,i)=>{var n=i(1167);n.defaultShader("Image",new n.WebGLShader("attribute vec2 aPosition;\nattribute vec3 aOrientation;\nattribute vec2 aLayer;\nattribute vec2 aTextureCoord;\n\nvarying mediump vec3 vTextureCoord;\n\nuniform vec4 uViewport;\nuniform mediump vec2 uTextureDimensions;\n\nmat4 viewportScale = mat4(2.0 / uViewport.z, 0, 0, 0,    0, -2.0 / uViewport.w, 0,0,    0, 0,1,0,    -1,+1,0,1);\nvec4 viewportTranslation = vec4(uViewport.xy, 0, 0);\n\nvoid main() {\n  vec2 pos = aPosition;\n  vec2 entityOrigin = aOrientation.xy;\n  mat2 entityRotationMatrix = mat2(cos(aOrientation.z), sin(aOrientation.z), -sin(aOrientation.z), cos(aOrientation.z));\n  \n  pos = entityRotationMatrix * (pos - entityOrigin) + entityOrigin ;\n  gl_Position = viewportScale * (viewportTranslation + vec4(pos, 1.0/(1.0+exp(aLayer.x) ), 1) );\n  vTextureCoord = vec3(aTextureCoord, aLayer.y);\n}","varying mediump vec3 vTextureCoord;\n  \nuniform sampler2D uSampler;\nuniform mediump vec2 uTextureDimensions;\n\nvoid main(void) {\n  highp vec2 coord =   vTextureCoord.xy / uTextureDimensions;\n  mediump vec4 base_color = texture2D(uSampler, coord);\n  gl_FragColor = vec4(base_color.rgb*base_color.a*vTextureCoord.z, base_color.a*vTextureCoord.z);\n}",[{name:"aPosition",width:2},{name:"aOrientation",width:3},{name:"aLayer",width:2},{name:"aTextureCoord",width:2}],(function(t,e){var i=t.pos;t.program.writeVector("aTextureCoord",0,0,0,i._h,i._w,0,i._w,i._h)}))),n.c("Image",{_repeat:"repeat",ready:!1,init:function(){this.bind("Draw",this._drawImage),this.bind("LayerAttached",this._setupImage)},remove:function(){this.unbind("LayerAttached",this._setupImage),this.unbind("Draw",this._drawImage)},image:function(t,e){if(this.__image=t,this._repeat=e||"no-repeat",this.img=n.asset(t),this.img)this._setupImage(this._drawLayer);else{this.img=new Image,n.asset(t,this.img),this.img.src=t;var i=this;this.img.onload=function(){i._setupImage(i._drawLayer)}}return this.trigger("Invalidate"),this},_setupImage:function(t){this.img&&t&&("Canvas"===t.type?this._pattern=this._drawContext.createPattern(this.img,this._repeat):"WebGL"===t.type&&(this._establishShader("image:"+this.__image,n.defaultShader("Image")),this.program.setTexture(this._drawLayer.makeTexture(this.__image,this.img,"no-repeat"!==this._repeat))),"no-repeat"===this._repeat&&(this.w=this.w||this.img.width,this.h=this.h||this.img.height),this.ready=!0,this.trigger("Invalidate"))},_drawImage:function(t){if("canvas"===t.type){if(!this.ready||!this._pattern)return;var e=t.ctx;e.fillStyle=this._pattern,e.save(),e.translate(t.pos._x,t.pos._y),e.fillRect(0,0,t.pos._w,t.pos._h),e.restore()}else"DOM"===t.type?this.__image&&(t.style.backgroundImage="url("+this.__image+")",t.style.backgroundRepeat=this._repeat):"webgl"===t.type&&t.program.draw(t,this)}})},2931:(t,e,i)=>{var n=i(1167);n.extend({_drawLayerTemplates:{},_drawLayers:[],_addDrawLayerInstance:function(t){n._drawLayers.push(t),this._drawLayers.sort((function(t,e){return t.options.z-e.options.z}))},_removeDrawLayerInstance:function(t){var e=this._drawLayers.indexOf(t);e>=0&&this._drawLayers.splice(e,1),this._drawLayers.sort((function(t,e){return t.options.z-e.options.z}))},_registerLayerTemplate:function(t,e){this._drawLayerTemplates[t]=e;var i=this._commonLayerProperties;for(var n in i)e[n]||(e[n]=i[n])},_commonLayerProperties:{options:{xResponse:1,yResponse:1,scaleResponse:1,z:0},_pointerEntities:0,_dirtyViewport:!1,_cachedViewportRect:null,init:function(){this._cachedViewportRect={},this.trigger("LayerInit"),this.uniqueBind("InvalidateViewport",(function(){this._dirtyViewport=!0})),this.trigger("PixelartSet",n._pixelartEnabled),n._addDrawLayerInstance(this)},remove:function(){this.trigger("LayerRemove"),n._removeDrawLayerInstance(this)},_sort:function(t,e){return t._globalZ-e._globalZ},_viewportRect:function(t){var e=this._cachedViewportRect;if(t)return e;var i=n.viewport,r=this.options,s=Math.pow(i._scale,r.scaleResponse);return e._scale=s,e._w=i._width/s,e._h=i._height/s,e._x=r.xResponse*-i._x-.5*(r.xResponse-1)*(1-1/s)*i._width,e._y=r.yResponse*-i._y-.5*(r.yResponse-1)*(1-1/s)*i._height,e},_viewTransformRect:function(t,e,i){var n=this._viewportRect(i),r=n._scale;return(e=e||{})._x=t._x*r+Math.round(-n._x*r),e._y=t._y*r+Math.round(-n._y*r),e._w=t._w*r,e._h=t._h*r,e}},createLayer:function(t,e,i){var r=this._drawLayerTemplates[e];n.s(t,r,i),n.c(t,{init:function(){this.requires("Renderable"),this._customLayer=!0,this.requires(r.type),this._attachToLayer(n.s(t))},remove:function(){this._detachFromLayer()}})}})},8832:(t,e,i)=>{var n=i(1167);n.c("Particles",{required:"Renderable",ready:!0,_particlesPaused:!1,init:function(){this._Particles=n.clone(this._Particles),this._Particles.init(),this._Particles.parentEntity=this},events:{UpdateFrame:function(){!this._particlesPaused&&this._Particles.active&&(this._Particles.update(),this.trigger("Invalidate"))},Draw:function(t){this._Particles.active&&"canvas"===t.type&&this._Particles.render(t)}},particles:function(t){return this._Particles.config(t),this._Particles.start(),this},_Particles:{presets:{maxParticles:150,size:18,sizeRandom:4,speed:1,speedRandom:1.2,lifeSpan:29,lifeSpanRandom:7,angle:65,angleRandom:34,startColour:[255,131,0,1],startColourRandom:[48,50,45,0],endColour:[245,35,0,0],endColourRandom:[60,60,60,0],sharpness:20,sharpnessRandom:10,spread:10,duration:-1,fastMode:!1,gravity:{x:0,y:.1},jitter:0,originOffset:{x:0,y:0}},emissionRate:0,elapsedFrames:0,emitCounter:0,active:!0,particles:[],init:function(){for(var t in this.presets)this[t]=this.presets[t]},config:function(t){for(var e in t=t||{})this[e]=t[e];if(this.emissionRate=this.maxParticles/this.lifeSpan,this.particles.length!==this.maxParticles){this.particles.length=0;for(var i=0,n=this.maxParticles;i<n;++i)this.particles.push(new this.Particle)}},start:function(){this.active=!0,this.elapsedFrames=0,this.emitCounter=0;for(var t=this.particles,e=0,i=t.length;e<i;++e)t[e].timeToLive=0;this.parentEntity.trigger("ParticleStart")},stop:function(){this.active=!1,this.parentEntity.trigger("ParticleEnd")},initParticle:function(t){var e,i,n,r,s,o,a,h,u,c,l,d,_,p;t.timeToLive=r=this.lifeSpan+this.lifeSpanRandom*this.RANDM1TO1(),t.positionX=this.originOffset.x+this.spread*this.RANDM1TO1(),t.positionY=this.originOffset.y+this.spread*this.RANDM1TO1(),e=(this.angle+this.angleRandom*this.RANDM1TO1())*(Math.PI/180),i=this.speed+this.speedRandom*this.RANDM1TO1(),t.directionX=Math.sin(e)*i,t.directionY=-Math.cos(e)*i,n=this.size+this.sizeRandom*this.RANDM1TO1(),t.size=n=n<0?0:~~n,s=this.sharpness+this.sharpnessRandom*this.RANDM1TO1(),t.sharpness=s=s>100?100:s<0?0:s,t.sizeSmall=~~(n/200*s),o=a=this.startColour[0]+this.startColourRandom[0]*this.RANDM1TO1(),t.colourR=o>255?255:o<0?0:~~o,o=h=this.startColour[1]+this.startColourRandom[1]*this.RANDM1TO1(),t.colourG=o>255?255:o<0?0:~~o,o=u=this.startColour[2]+this.startColourRandom[2]*this.RANDM1TO1(),t.colourB=o>255?255:o<0?0:~~o,o=c=this.startColour[3]+this.startColourRandom[3]*this.RANDM1TO1(),t.colourA=o>1?1:o<0?0:~~(100*o)/100,l=this.endColour[0]+this.endColourRandom[0]*this.RANDM1TO1(),d=this.endColour[1]+this.endColourRandom[1]*this.RANDM1TO1(),_=this.endColour[2]+this.endColourRandom[2]*this.RANDM1TO1(),p=this.endColour[3]+this.endColourRandom[3]*this.RANDM1TO1(),t.deltaColourR=(l-a)/r,t.deltaColourG=(d-h)/r,t.deltaColourB=(_-u)/r,t.deltaColourA=(p-c)/r},update:function(){var t=this.RANDM1TO1,e=this.gravity.x,i=this.gravity.y,n=this.jitter;this.elapsedFrames++,this.duration>=0&&this.duration<this.elapsedFrames&&this.stop();var r=this.emissionRate>0?1/this.emissionRate:1/0;this.emitCounter++;for(var s,o,a=this.particles,h=0,u=a.length;h<u;++h)(o=a[h]).timeToLive>0?(o.directionX+=e,o.directionY+=i,o.positionX+=o.directionX,o.positionY+=o.directionY,n&&(o.positionX+=n*t(),o.positionY+=n*t()),s=o.colourR+o.deltaColourR,o.colourR=s>255?255:s<0?0:~~s,s=o.colourG+o.deltaColourG,o.colourG=s>255?255:s<0?0:~~s,s=o.colourB+o.deltaColourB,o.colourB=s>255?255:s<0?0:~~s,s=o.colourA+o.deltaColourA,o.colourA=s>1?1:s<0?0:~~(100*s)/100,o.timeToLive--):this.emitCounter>r&&(this.initParticle(o),this.emitCounter-=r)},render:function(t){for(var e,i=t.ctx,n=",",r=this.particles,s=0,o=r.length;s<o;s++){var a=(e=r[s]).size,h=a>>1;if(!(e.positionX<0||e.positionX+a>t.pos._w||e.positionY<0||e.positionY+a>t.pos._h)){var u=~~(t.pos._x+e.positionX),c=~~(t.pos._y+e.positionY),l=e.colourR,d=e.colourG,_=e.colourB,p="rgba("+l+n+d+n+_+n+e.colourA+")";if(this.fastMode)i.fillStyle=p;else{var f="rgba("+l+n+d+n+_+",0)",g=i.createRadialGradient(u+h,c+h,e.sizeSmall,u+h,c+h,h);g.addColorStop(0,p),g.addColorStop(.9,f),i.fillStyle=g}i.fillRect(u,c,a,a)}}},Particle:function(){this.positionX=0,this.positionY=0,this.directionX=0,this.directionY=0,this.size=0,this.sizeSmall=0,this.timeToLive=0,this.colourR=0,this.colourG=0,this.colourB=0,this.colourA=0,this.deltaColourR=0,this.deltaColourG=0,this.deltaColourB=0,this.deltaColourA=0,this.sharpness=0},RANDM1TO1:function(){return 2*Math.random()-1}},pauseParticles:function(){this._particlesPaused=!0},resumeParticles:function(){this._particlesPaused=!1}})},5716:(t,e,i)=>{i(1167).c("Renderable",{_changed:!1,_alpha:1,_visible:!0,_setterRenderable:function(t,e){this[t]!==e&&(this[t]=e,this.trigger("Invalidate"))},properties:{alpha:{set:function(t){this._setterRenderable("_alpha",t)},get:function(){return this._alpha},configurable:!0,enumerable:!0},_alpha:{enumerable:!1},visible:{set:function(t){this._setterRenderable("_visible",t)},get:function(){return this._visible},configurable:!0,enumerable:!0},_visible:{enumerable:!1}},init:function(){},_hideOnUnfreeze:!1,events:{Freeze:function(){this._hideOnUnfreeze=!this._visible,this._visible=!1,this.trigger("Invalidate")},Unfreeze:function(){this._visible=!this._hideOnUnfreeze,this.trigger("Invalidate")}},_invalidateRenderable:function(){!1===this._changed&&(this._changed=!0,this._drawLayer.dirty(this))},_attachToLayer:function(t){this._drawLayer&&this._detachFromLayer(),this._drawLayer=t,t.attach(this),this.bind("Invalidate",this._invalidateRenderable),this.trigger("LayerAttached",t),this.trigger("Invalidate")},_detachFromLayer:function(){this._drawLayer&&(this._drawLayer.detach(this),this.unbind("Invalidate",this._invalidateRenderable),this.trigger("LayerDetached",this._drawLayer),delete this._drawLayer)},flip:function(t){return this["_flip"+(t=t||"X")]||(this["_flip"+t]=!0,this.trigger("Invalidate")),this},unflip:function(t){return this["_flip"+(t=t||"X")]&&(this["_flip"+t]=!1,this.trigger("Invalidate")),this}})},2798:(t,e,i)=>{var n=i(1167);n.c("SpriteAnimation",{_reels:null,_currentReelId:null,_currentReel:null,_isPlaying:!1,animationSpeed:1,init:function(){this._reels={}},reel:function(t,e,i,r,s,o){if(0===arguments.length)return this._currentReelId;if(1===arguments.length&&"string"==typeof t){if(void 0===this._reels[t])throw"The specified reel "+t+" is undefined.";return this.pauseAnimation(),this._currentReelId!==t&&(this._currentReelId=t,this._currentReel=this._reels[t],this._updateSprite(),this.trigger("ReelChange",this._currentReel)),this}var a,h;if((a={id:t,frames:[],currentFrame:0,easing:new n.easing(e),defaultLoops:1}).duration=a.easing.duration,"number"==typeof i)if(o=o||1/0,s>=0)for(h=0;h<s;++h)a.frames.push([i,r]),++i>=o&&(i=0,r++);else for(h=0;h>s;--h)a.frames.push([i,r]),--i<0&&(i=o-1,r--);else{if(3!==arguments.length||"object"!=typeof i)throw"Unrecognized arguments. Please see the documentation for 'reel(...)'.";a.frames=i}return this._reels[t]=a,this},animate:function(t,e){"string"==typeof t&&this.reel(t);var i=this._currentReel;if(null==i)throw"No reel is specified, and there is no currently active reel.";return this.pauseAnimation(),void 0===e&&(e="number"==typeof t?t:1),i.easing.reset(),this.loops(e),this._setFrame(0),this.bind("UpdateFrame",this._animationTick),this._isPlaying=!0,this.trigger("StartAnimation",i),this},resumeAnimation:function(){return!1===this._isPlaying&&null!==this._currentReel&&(this.bind("UpdateFrame",this._animationTick),this._isPlaying=!0,this._currentReel.easing.resume(),this.trigger("StartAnimation",this._currentReel)),this},pauseAnimation:function(){return!0===this._isPlaying&&(this.unbind("UpdateFrame",this._animationTick),this._isPlaying=!1,this._reels[this._currentReelId].easing.pause()),this},resetAnimation:function(){var t=this._currentReel;if(null===t)throw"No active reel to reset.";return this.reelPosition(0),t.easing.repeat(t.defaultLoops),this},loops:function(t){return 0===arguments.length?null!==this._currentReel?this._currentReel.easing.loops:0:(null!==this._currentReel&&(t<0&&(t=1/0),this._currentReel.easing.repeat(t),this._currentReel.defaultLoops=t),this)},reelPosition:function(t){if(null===this._currentReel)throw"No active reel.";if(0===arguments.length)return this._currentReel.currentFrame;var e,i=this._currentReel.frames.length;if("end"===t&&(t=i-1),t<1&&t>0)e=t,t=Math.floor(i*e);else{if(t!==Math.floor(t))throw"Position "+t+" is invalid.";t<0&&(t=i-1+t),e=t/i}return t=Math.min(t,i-1),t=Math.max(t,0),this._setProgress(e),this._setFrame(t),this},reelFrame:function(t){if(null===this._currentReel)throw"No active reel.";var e=this._currentReel.frames.indexOf(t);if(-1===e)throw"Frame name "+t+" is invalid.";return this.reelPosition(e),this},_animationTick:function(t){var e=this._reels[this._currentReelId];e.easing.tick(t.dt*this.animationSpeed);var i=e.easing.value(),n=Math.min(Math.floor(e.frames.length*i),e.frames.length-1);this._setFrame(n),!0===e.easing.complete&&(this.pauseAnimation(),this.trigger("AnimationEnd",this._currentReel))},_setFrame:function(t){var e=this._currentReel;t!==e.currentFrame&&(e.currentFrame=t,this._updateSprite(),this.trigger("FrameChange",e))},_updateSprite:function(){var t=this._currentReel,e=t.frames[t.currentFrame];"string"==typeof e?this.sprite(e):this.sprite(e[0],e[1])},_setProgress:function(t,e){this._currentReel.easing.setProgress(t,e)},isPlaying:function(t){return!!this._isPlaying&&(t?this._currentReelId===t:!!this._currentReelId)},getReel:function(t){if(0===arguments.length){if(!this._currentReelId)return null;t=this._currentReelId}return this._reels[t]}})},2675:(t,e,i)=>{var n=i(1167);n.defaultShader("Sprite",new n.WebGLShader("attribute vec2 aPosition;\nattribute vec3 aOrientation;\nattribute vec2 aLayer;\nattribute vec2 aTextureCoord;\n\nvarying mediump vec3 vTextureCoord;\n\nuniform vec4 uViewport;\nuniform mediump vec2 uTextureDimensions;\n\nmat4 viewportScale = mat4(2.0 / uViewport.z, 0, 0, 0,    0, -2.0 / uViewport.w, 0,0,    0, 0,1,0,    -1,+1,0,1);\nvec4 viewportTranslation = vec4(uViewport.xy, 0, 0);\n\nvoid main() {\n  vec2 pos = aPosition;\n  vec2 entityOrigin = aOrientation.xy;\n  mat2 entityRotationMatrix = mat2(cos(aOrientation.z), sin(aOrientation.z), -sin(aOrientation.z), cos(aOrientation.z));\n  \n  pos = entityRotationMatrix * (pos - entityOrigin) + entityOrigin ;\n  gl_Position = viewportScale * (viewportTranslation + vec4(pos, 1.0/(1.0+exp(aLayer.x) ), 1) );\n  vTextureCoord = vec3(aTextureCoord, aLayer.y);\n}","varying mediump vec3 vTextureCoord;\n  \nuniform sampler2D uSampler;\nuniform mediump vec2 uTextureDimensions;\n\nvoid main(void) {\n  highp vec2 coord =   vTextureCoord.xy / uTextureDimensions;\n  mediump vec4 base_color = texture2D(uSampler, coord);\n  gl_FragColor = vec4(base_color.rgb*base_color.a*vTextureCoord.z, base_color.a*vTextureCoord.z);\n}",[{name:"aPosition",width:2},{name:"aOrientation",width:3},{name:"aLayer",width:2},{name:"aTextureCoord",width:2}],(function(t,e){var i=t.co;t.program.writeVector("aTextureCoord",i.x,i.y,i.x,i.y+i.h,i.x+i.w,i.y,i.x+i.w,i.y+i.h)}))),n.extend({sprite:function(t,e,i,r,s,o,a){var h,u,c;"string"==typeof t&&(o=s,s=r,r=e,i=t,t=1,e=1),"string"==typeof e&&(o=s,s=r,r=i,i=e,e=t),!o&&s&&(o=s),s=parseInt(s||0,10),o=parseInt(o||0,10);var l=function(){this.ready=!0,this.trigger("Invalidate")};(c=n.asset(i))||((c=new Image).src=i,n.asset(i,c),c.onload=function(){for(var t in r)n(t).each(l)});var d=function(){this.requires("2D, Sprite"),this.__trim=[0,0,0,0],this.__image=i,this.__map=r,this.__coord=[this.__coord[0],this.__coord[1],this.__coord[2],this.__coord[3]],this.__tile=t,this.__tileh=e,this.__padding=[s,o],this.__padBorder=a,this.sprite(this.__coord[0],this.__coord[1],this.__coord[2],this.__coord[3]),this.img=c,this.img.complete&&this.img.width>0&&(this.ready=!0,this.trigger("Invalidate")),this.w=this.__coord[2],this.h=this.__coord[3],this._setupSpriteImage(this._drawLayer)};for(h in r)r.hasOwnProperty(h)&&(u=r[h],n.c(h,{ready:!1,__coord:[u[0],u[1],u[2]||1,u[3]||1],init:d}));return this}}),n.c("Sprite",{__image:"",__tile:0,__tileh:0,__padding:null,__trim:null,img:null,ready:!1,init:function(){this.__trim=[0,0,0,0],this.bind("Draw",this._drawSprite),this.bind("LayerAttached",this._setupSpriteImage)},remove:function(){this.unbind("Draw",this._drawSprite),this.unbind("LayerAttached",this._setupSpriteImage)},_setupSpriteImage:function(t){this.__image&&this.img&&t&&"WebGL"===t.type&&(this._establishShader(this.__image,n.defaultShader("Sprite")),this.program.setTexture(t.makeTexture(this.__image,this.img,!1)))},_drawSprite:function(t){var e=t.co,i=t.pos,n=t.ctx;if("canvas"===t.type)n.drawImage(this.img,e.x,e.y,e.w,e.h,i._x,i._y,i._w,i._h);else if("DOM"===t.type){var r=this._h/e.h,s=this._w/e.w,o=this._element.style,a=o.backgroundColor;"initial"===a&&(a="");var h=a+" url('"+this.__image+"') no-repeat";h!==o.background&&(o.background=h),o.backgroundPosition="-"+e.x*s+"px -"+e.y*r+"px",1===r&&1===s||(o.backgroundSize=this.img.width*s+"px "+this.img.height*r+"px")}else"webgl"===t.type&&t.program.draw(t,this)},sprite:function(t,e,i,n){if("string"==typeof t){var r=this.__map[t];if(!r)return this;t=r[0],e=r[1],i=r[2]||1,n=r[3]||1}return this.__coord=this.__coord||[0,0,0,0],this.__coord[0]=t*(this.__tile+this.__padding[0])+(this.__padBorder?this.__padding[0]:0)+this.__trim[0],this.__coord[1]=e*(this.__tileh+this.__padding[1])+(this.__padBorder?this.__padding[1]:0)+this.__trim[1],void 0!==i&&void 0!==n&&(this.__coord[2]=this.__trim[2]||i*this.__tile||this.__tile,this.__coord[3]=this.__trim[3]||n*this.__tileh||this.__tileh),this.trigger("Invalidate"),this},crop:function(t,e,i,n){var r=this._mbr||this.pos();return this.__trim=[],this.__trim[0]=t,this.__trim[1]=e,this.__trim[2]=i,this.__trim[3]=n,this.__coord[0]+=t,this.__coord[1]+=e,this.__coord[2]=i,this.__coord[3]=n,this._w=i,this._h=n,this.trigger("Invalidate",r),this}})},7073:(t,e,i)=>{var n,r,s=i(1167);s.c("Text",{_text:"",defaultSize:"10px",defaultFamily:"sans-serif",defaultVariant:"normal",defaultLineHeight:"normal",defaultTextAlign:"left",ready:!0,init:function(){this.requires("2D"),this._textFont={type:"",weight:"",size:this.defaultSize,lineHeight:this.defaultLineHeight,family:this.defaultFamily,variant:this.defaultVariant},this._textAlign=this.defaultTextAlign},events:{Draw:function(t){var e=this._fontString();if("DOM"===t.type){var i=this._element,n=i.style;n.color=this._textColor,n.font=e,n.textAlign=this._textAlign,i.innerHTML=this._text}else if("canvas"===t.type){var r=t.ctx;r.save(),r.textBaseline="top",r.fillStyle=this._textColor||"rgb(0,0,0)",r.font=e,r.textAlign=this._textAlign,r.fillText(this._text,t.pos._x,t.pos._y),r.restore()}},SetStyle:function(t){switch(t){case"textAlign":this._textAlign=this._element.style.textAlign;break;case"color":this.textColor(this._element.style.color);break;case"fontType":this._textFont.type=this._element.style.fontType;break;case"fontWeight":this._textFont.weight=this._element.style.fontWeight;break;case"fontSize":this._textFont.size=this._element.style.fontSize;break;case"fontFamily":this._textFont.family=this._element.style.fontFamily;break;case"fontVariant":this._textFont.variant=this._element.style.fontVariant;break;case"lineHeight":this._textFont.lineHeight=this._element.style.lineHeight}}},remove:function(){this.unbind(this._textUpdateEvent,this._dynamicTextUpdate)},_getFontHeight:(n=/([a-zA-Z]+)\b/,r={px:1,pt:4/3,pc:16,cm:96/2.54,mm:96/25.4,in:96,em:void 0,ex:void 0},function(t){var e=parseFloat(t),i=n.exec(t),s=i?i[1]:"px";return void 0!==r[s]?Math.ceil(e*r[s]):Math.ceil(e)}),_textGenerator:null,text:function(t,e){return null==t?this._text:("function"==typeof t?(this._text=t.call(this,e),this._textGenerator=t):(this._text=t,this._textGenerator=null),this.has("Canvas")&&this._resizeForCanvas(),this.trigger("Invalidate"),this)},_dynamicTextOn:!1,_textUpdateEvent:null,_dynamicTextUpdate:function(t){this._textGenerator&&this.text(this._textGenerator,t)},dynamicTextGeneration:function(t,e){return this.unbind(this._textUpdateEvent,this._dynamicTextUpdate),t&&(this._textUpdateEvent=e||"UpdateFrame",this.bind(this._textUpdateEvent,this._dynamicTextUpdate)),this},_resizeForCanvas:function(){var t=this._drawContext;t.font=this._fontString(),this.w=t.measureText(this._text).width;var e=this._textFont.size||this.defaultSize;this.h=1.1*this._getFontHeight(e),"left"===this._textAlign||"start"===this._textAlign?this.offsetBoundary(0,0,0,0):"center"===this._textAlign?this.offsetBoundary(this.w/2,0,-this.w/2,0):"end"!==this._textAlign&&"right"!==this._textAlign||this.offsetBoundary(this.w,0,-this.w,0)},_fontString:function(){return this._textFont.type+" "+this._textFont.variant+" "+this._textFont.weight+" "+this._textFont.size+" / "+this._textFont.lineHeight+" "+this._textFont.family},textColor:function(t){return s.assignColor(t,this),this._textColor="rgba("+this._red+", "+this._green+", "+this._blue+", "+this._strength+")",this.trigger("Invalidate"),this},textAlign:function(t){return this._textAlign=t,this.has("Canvas")&&this._resizeForCanvas(),this.trigger("Invalidate"),this},textFont:function(t,e){if(1===arguments.length){if("string"==typeof t)return this._textFont[t];if("object"==typeof t)for(var i in t)this._textFont[i]="family"===i?"'"+t[i]+"'":t[i]}else this._textFont[t]=e;return this.has("Canvas")&&this._resizeForCanvas(),this.trigger("Invalidate"),this},unselectable:function(){return this.has("DOM")&&(this.css({"-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",cursor:"default"}),this.trigger("Invalidate")),this}})},940:(t,e,i)=>{var n=i(1167),r=window.document;n.extend({viewport:{clampToEntities:!0,_width:0,_height:0,_x:0,_y:0,_scale:1,bounds:null,scroll:function(t,e){this[t]=e,n.trigger("ViewportScroll"),n.trigger("InvalidateViewport")},rect_object:{_x:0,_y:0,_w:0,_h:0},rect:function(t){return(t=t||this.rect_object)._x=-this._x,t._y=-this._y,t._w=this._width/this._scale,t._h=this._height/this._scale,t},pan:function(){var t,e,i,r,s;function o(o){s.tick(o.dt);var h=s.value();n.viewport.x=(1-h)*i+h*t,n.viewport.y=(1-h)*r+h*e,n.viewport._clamp(),s.complete&&(a(),n.trigger("CameraAnimationDone"))}function a(){n.unbind("UpdateFrame",o)}return n._preBind("StopCamera",a),function(a,h,u,c){n.trigger("StopCamera"),"reset"!==a&&(i=n.viewport._x,r=n.viewport._y,t=i-a,e=r-h,s=new n.easing(u,c),n.uniqueBind("UpdateFrame",o))}}(),follow:function(){var t,e,i;function r(){var t=n.viewport._scale;n.viewport.scroll("_x",-(this.x+this.w/2-n.viewport.width/2/t-e*t)),n.viewport.scroll("_y",-(this.y+this.h/2-n.viewport.height/2/t-i*t)),n.viewport._clamp()}return n._preBind("StopCamera",(function(){t&&(t.unbind("Move",r),t.unbind("ViewportScale",r),t.unbind("ViewportResize",r))})),function(s,o,a){s&&s.has("2D")&&(n.trigger("StopCamera"),t=s,e=void 0!==o?o:0,i=void 0!==a?a:0,s.bind("Move",r),s.bind("ViewportScale",r),s.bind("ViewportResize",r),r.call(s))}}(),centerOn:function(t,e){var i=t.x+n.viewport.x,r=t.y+n.viewport.y,s=t.w/2,o=t.h/2,a=i+s-n.viewport.width/2/n.viewport._scale,h=r+o-n.viewport.height/2/n.viewport._scale;n.viewport.pan(a,h,e)},zoom:function(){function t(){n.unbind("UpdateFrame",c)}var e,i,r,s,o,a,h,u;function c(i){var c,l;u.tick(i.dt),c=Math.pow(r,u.value()),l=1===r?u.value():(1/c-1)/(1/r-1),n.viewport.scale(c*e),n.viewport.scroll("_x",s*(1-l)+o*l),n.viewport.scroll("_y",a*(1-l)+h*l),n.viewport._clamp(),u.complete&&(t(),n.trigger("CameraAnimationDone"))}return n._preBind("StopCamera",t),function(t,l,d,_,p){t?(arguments.length<=2&&(_=l,l=n.viewport.x-n.viewport.width,d=n.viewport.y-n.viewport.height),n.trigger("StopCamera"),e=n.viewport._scale,i=e*(r=t),s=n.viewport.x,a=n.viewport.y,o=-(l-n.viewport.width/(2*i)),h=-(d-n.viewport.height/(2*i)),u=new n.easing(_,p),n.uniqueBind("UpdateFrame",c)):n.viewport.scale(1)}}(),scale:function(t){this._scale=t||1,n.trigger("InvalidateViewport"),n.trigger("ViewportScale")},mouselook:function(){var t,e=!1,i=!1,r={x:0,y:0},s={x:0,y:0};function o(t){i||t.target||(n.trigger("StopCamera"),r.x=t.clientX,r.y=t.clientY,i=!0)}function a(t){if(i){s.x=t.clientX-r.x,s.y=t.clientY-r.y,r.x=t.clientX,r.y=t.clientY;var e=n.viewport;e.x+=s.x/e._scale,e.y+=s.y/e._scale,e._clamp()}}function h(t){i&&(i=!1)}return function(i){t=n.s("Mouse"),i&&!e?(t.bind("MouseDown",o),t.bind("MouseMove",a),t.bind("MouseUp",h),e=i):!i&&e&&(t.unbind("MouseDown",o),t.unbind("MouseMove",a),t.unbind("MouseUp",h),e=i)}}(),_clamp:function(){if(this.clampToEntities){var t=n.clone(this.bounds)||n.map.boundaries();t.max.x*=this._scale,t.min.x*=this._scale,t.max.y*=this._scale,t.min.y*=this._scale,t.max.x-t.min.x>n.viewport.width?n.viewport.x<(-t.max.x+n.viewport.width)/this._scale?n.viewport.x=(-t.max.x+n.viewport.width)/this._scale:n.viewport.x>-t.min.x&&(n.viewport.x=-t.min.x):n.viewport.x=-1*(t.min.x+(t.max.x-t.min.x)/2-n.viewport.width/2),t.max.y-t.min.y>n.viewport.height?n.viewport.y<(-t.max.y+n.viewport.height)/this._scale?n.viewport.y=(-t.max.y+n.viewport.height)/this._scale:n.viewport.y>-t.min.y&&(n.viewport.y=-t.min.y):n.viewport.y=-1*(t.min.y+(t.max.y-t.min.y)/2-n.viewport.height/2)}},init:function(t,e,i){var s;if(void 0===i&&void 0===e&&void 0!==t&&"number"!=typeof t&&(i=t,t=window.innerWidth,e=window.innerHeight),n.createLayer("DefaultCanvasLayer","Canvas",{z:20}),n.createLayer("DefaultDOMLayer","DOM",{z:30}),n.createLayer("DefaultWebGLLayer","WebGL",{z:10}),this._defineViewportProperties(),this._x=0,this._y=0,this._scale=1,this.bounds=null,this._width=t||window.innerWidth,this._height=e||window.innerHeight,void 0===i&&(i="cr-stage"),"string"==typeof i)s=r.getElementById(i);else{if(!("undefined"!=typeof HTMLElement?i instanceof HTMLElement:i instanceof Element))throw new TypeError("stage_elem must be a string or an HTMLElement");s=i}n.stage={x:0,y:0,fullscreen:!1,elem:s||r.createElement("div")},t||e||(r.body.style.overflow="hidden",n.stage.fullscreen=!0),n.addEvent(this,window,"resize",n.viewport.reload),n.addEvent(this,window,"blur",(function(){n.settings.get("autoPause")&&(n._paused||n.pause())})),n.addEvent(this,window,"focus",(function(){n._paused&&n.settings.get("autoPause")&&n.pause()})),n.settings.register("stageSelectable",(function(t){n.stage.elem.onselectstart=t?function(){return!0}:function(){return!1}})),n.settings.modify("stageSelectable",!1),n.settings.register("stageContextMenu",(function(t){n.stage.elem.oncontextmenu=t?function(){return!0}:function(){return!1}})),n.settings.modify("stageContextMenu",!1),n.settings.register("autoPause",(function(){})),n.settings.modify("autoPause",!1),s||(r.body.appendChild(n.stage.elem),n.stage.elem.id=i);var o,a=n.stage.elem.style;if(a.width=this.width+"px",a.height=this.height+"px",a.overflow="hidden",n.bind("ViewportResize",(function(){n.trigger("InvalidateViewport")})),n.mobile){void 0!==typeof a.webkitTapHighlightColor&&(a.webkitTapHighlightColor="rgba(0,0,0,0)");var h=r.createElement("meta"),u=r.getElementsByTagName("head")[0];(h=r.createElement("meta")).setAttribute("name","apple-mobile-web-app-capable"),h.setAttribute("content","yes"),u.appendChild(h),n.addEvent(this,n.stage.elem,"touchmove",(function(t){t.preventDefault()}))}a.position="relative",o=n.domHelper.innerPosition(n.stage.elem),n.stage.x=o.x,n.stage.y=o.y,n.uniqueBind("ViewportResize",this._resize)},_resize:function(){n.stage.elem.style.width=n.viewport.width+"px",n.stage.elem.style.height=n.viewport.height+"px"},_defineViewportProperties:function(){Object.defineProperty(this,"x",{set:function(t){this.scroll("_x",t)},get:function(){return this._x},configurable:!0}),Object.defineProperty(this,"y",{set:function(t){this.scroll("_y",t)},get:function(){return this._y},configurable:!0}),Object.defineProperty(this,"width",{set:function(t){this._width=t,n.trigger("ViewportResize")},get:function(){return this._width},configurable:!0}),Object.defineProperty(this,"height",{set:function(t){this._height=t,n.trigger("ViewportResize")},get:function(){return this._height},configurable:!0})},reload:function(){var t,e=window.innerWidth,i=window.innerHeight;n.stage.fullscreen&&(this._width=e,this._height=i,n.trigger("ViewportResize")),t=n.domHelper.innerPosition(n.stage.elem),n.stage.x=t.x,n.stage.y=t.y},reset:function(){n.viewport.mouselook(!1),n.trigger("StopCamera"),n.viewport.scroll("_x",0),n.viewport.scroll("_y",0),n.viewport.scale(1)},onScreen:function(t){return n.viewport._x+t._x+t._w>0&&n.viewport._y+t._y+t._h>0&&n.viewport._x+t._x<n.viewport.width&&n.viewport._y+t._y<n.viewport.height}}})},9284:(t,e,i)=>{var n=i(1167),r=window.document;function s(t,e){this.shader=e,this.layer=t,this.context=t.context,this.draw=function(){},this.array_size=16,this.max_size=1024,this._indexArray=new Uint16Array(6*this.array_size),this._indexBuffer=t.context.createBuffer()}s.prototype={initAttributes:function(t){this.attributes=t,this._attribute_table={};for(var e=0,i=0;i<t.length;i++){var n=t[i];this._attribute_table[n.name]=n,n.bytes=n.bytes||Float32Array.BYTES_PER_ELEMENT,n.type=n.type||this.context.FLOAT,n.offset=e,n.location=this.context.getAttribLocation(this.shader,n.name),this.context.enableVertexAttribArray(n.location),e+=n.width}this.stride=e,this._attributeArray=new Float32Array(4*this.array_size*this.stride),this._attributeBuffer=this.context.createBuffer(),this._registryHoles=[],this._registrySize=0},growArrays:function(t){if(!(this.array_size>=this.max_size)){var e=Math.min(t,this.max_size),i=new Float32Array(4*e*this.stride),n=new Uint16Array(6*e);i.set(this._attributeArray),n.set(this._indexArray),this._attributeArray=i,this._indexArray=n,this.array_size=e}},registerEntity:function(t){if(0===this._registryHoles.length){if(this._registrySize>=this.max_size)throw"Number of entities exceeds maximum limit.";this._registrySize>=this.array_size&&this.growArrays(2*this.array_size),t._glBufferIndex=this._registrySize,this._registrySize++}else t._glBufferIndex=this._registryHoles.pop()},unregisterEntity:function(t){"number"==typeof t._glBufferIndex&&this._registryHoles.push(t._glBufferIndex),t._glBufferIndex=null},resetRegistry:function(){this._maxElement=0,this._registryHoles.length=0},setCurrentEntity:function(t){this.ent_offset=4*t._glBufferIndex,this.ent=t},switchTo:function(){var t=this.context;t.useProgram(this.shader),t.bindBuffer(t.ARRAY_BUFFER,this._attributeBuffer);for(var e,i=this.attributes,n=0;n<i.length;n++)e=i[n],t.vertexAttribPointer(e.location,e.width,e.type,!1,this.stride*e.bytes,e.offset*e.bytes);var r=this.texture_obj;r&&null===r.unit&&this.layer.texture_manager.bindTexture(r),this.index_pointer=0},setTexture:function(t){void 0===this.texture_obj&&(t.setToProgram(this.shader,"uSampler","uTextureDimensions"),this.texture_obj=t)},addIndices:function(t){var e=this._indexArray,i=this.index_pointer;e[0+i]=0+t,e[1+i]=1+t,e[2+i]=2+t,e[3+i]=1+t,e[4+i]=2+t,e[5+i]=3+t,this.index_pointer+=6},renderBatch:function(){var t=this.context;t.bindBuffer(t.ARRAY_BUFFER,this._attributeBuffer),t.bufferData(t.ARRAY_BUFFER,this._attributeArray,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this._indexArray,t.STATIC_DRAW),t.drawElements(t.TRIANGLES,this.index_pointer,t.UNSIGNED_SHORT,0)},setViewportUniforms:function(t,e){var i=this.context;i.useProgram(this.shader),i.uniform4f(this.shader.viewport,-t._x,-t._y,t._w,t._h)},writeVector:function(t,e,i){for(var n=this._attribute_table[t],r=this.stride,s=n.offset+this.ent_offset*r,o=n.width,a=arguments.length-1,h=this._attributeArray,u=0;u<4;u++)for(var c=0;c<o;c++)h[s+r*u+c]=arguments[(o*u+c)%a+1]}},n._registerLayerTemplate("WebGL",{type:"WebGL",context:null,_compileShader:function(t,e){var i=this.context,n=i.createShader(e);if(i.shaderSource(n,t),i.compileShader(n),!i.getShaderParameter(n,i.COMPILE_STATUS))throw i.getShaderInfoLog(n);return n},_makeProgram:function(t){var e=this.context,i=this._compileShader(t.fragmentCode,e.FRAGMENT_SHADER),n=this._compileShader(t.vertexCode,e.VERTEX_SHADER),r=e.createProgram();if(e.attachShader(r,n),e.attachShader(r,i),e.linkProgram(r),!e.getProgramParameter(r,e.LINK_STATUS))throw"Could not initialise shaders";return r.viewport=e.getUniformLocation(r,"uViewport"),r},getProgramWrapper:function(t,e){if(void 0===this.programs[t]){var i=new s(this,this._makeProgram(e));i.name=t,i.initAttributes(e.attributeList),i.draw=e.drawCallback,i.setViewportUniforms(this._viewportRect(),this.options),this.programs[t]=i}return this.programs[t]},makeTexture:function(t,e,i){return this.texture_manager.makeTexture(t,e,i)},events:{LayerInit:"layerInit",LayerRemove:"layerRemove",RenderScene:"_render",PixelartSet:"_setPixelart",ViewportResize:"_resize"},layerInit:function(){if(!n.support.webgl)return n.trigger("NoWebGL"),void n.stop();var t,e;this.programs={},(t=r.createElement("canvas")).width=n.viewport.width,t.height=n.viewport.height,t.style.position="absolute",t.style.left="0px",t.style.top="0px",t.style.zIndex=this.options.z,n.stage.elem.appendChild(t);try{(e=t.getContext("webgl",{premultipliedalpha:!0})||t.getContext("experimental-webgl",{premultipliedalpha:!0})).viewportWidth=t.width,e.viewportHeight=t.height}catch(t){return n.trigger("NoWebGL"),void n.stop()}this.context=e,this._canvas=t,e.clearColor(0,0,0,0),e.disable(e.DEPTH_TEST),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA),e.enable(e.BLEND),this.texture_manager=new n.TextureManager(e,this),this._dirtyViewport=!0},layerRemove:function(){this._canvas.parentNode.removeChild(this._canvas)},_resize:function(){var t=this._canvas;t.width=n.viewport.width,t.height=n.viewport.height;var e=this.context;e.viewportWidth=t.width,e.viewportHeight=t.height},_setPixelart:function(t){var e=this.context;this.texture_filter=t?e.NEAREST:e.LINEAR},visible_gl:[],_render:function(t){t=t||this._viewportRect();var e=this.context;e.viewport(0,0,e.viewportWidth,e.viewportHeight),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);var i=this.programs;if(this._dirtyViewport){var r=this._viewportRect();for(var s in i)i[s].setViewportUniforms(r,this.options);this._dirtyViewport=!1}var o,a=n.map.search(t),h=0,u=a.length,c=this.visible_gl;for(c.length=0,h=0;h<u;h++)(o=a[h])._visible&&o.program&&o._drawLayer===this&&c.push(o);c.sort(this._sort),u=c.length;var l=null;for(h=0;h<u;h++)l!==(o=c[h]).program&&(null!==l&&l.renderBatch(),(l=o.program).index_pointer=0,l.switchTo()),o.draw(),o._changed=!1;null!==l&&l.renderBatch()},dirty:function(t){},attach:function(t){t._drawContext=this.context},detach:function(t){t.program&&t.program.unregisterEntity(t)}})},2050:(t,e,i)=>{var n=i(1167);n.extend({WebGLShader:function(t,e,i,n){this.vertexCode=t,this.fragmentCode=e,this.attributeList=i,this.drawCallback=n},defaultShader:function(t,e){if(this._defaultShaders=this._defaultShaders||{},1===arguments.length)return this._defaultShaders[t];this._defaultShaders[t]=e}}),n.c("WebGL",{init:function(){this.requires("Renderable"),this._customLayer||this._attachToLayer(n.s("DefaultWebGLLayer"))},remove:function(){this._detachFromLayer()},drawVars:{type:"webgl",pos:{},ctx:null,coord:[0,0,0,0],co:{x:0,y:0,w:0,h:0}},draw:function(){if(this.ready){var t=this.drawVars.pos;t._x=this._x,t._y=this._y,t._w=this._w,t._h=this._h;var e=this.__coord||[0,0,0,0],i=this.drawVars.co;i.x=e[0],i.y=e[1],i.w=e[2],i.h=e[3],this._flipX&&(i.x=i.x+i.w,i.w=-i.w),this._flipY&&(i.y=i.y+i.h,i.h=-i.h);var n=this._drawContext;this.drawVars.gl=n;var r=this.drawVars.program=this.program;return r.setCurrentEntity(this),r.writeVector("aPosition",this._x,this._y,this._x,this._y+this._h,this._x+this._w,this._y,this._x+this._w,this._y+this._h),r.writeVector("aOrientation",this._origin.x+this._x,this._origin.y+this._y,this._rotation*Math.PI/180),r.writeVector("aLayer",this._globalZ,this._alpha),this.trigger("Draw",this.drawVars),r.addIndices(r.ent_offset),this}},_establishShader:function(t,e){this.program=this._drawLayer.getProgramWrapper(t,e),this.program.registerEntity(this),this.ready=!0}})},1846:(t,e,i)=>{var n=i(1167);n.extend({device:{_deviceOrientationCallback:!1,_deviceMotionCallback:!1,_normalizeDeviceOrientation:function(t){var e;window.DeviceOrientationEvent?e={tiltLR:t.gamma,tiltFB:t.beta,dir:t.alpha,motUD:null}:window.OrientationEvent&&(e={tiltLR:90*t.x,tiltFB:-90*t.y,dir:null,motUD:t.z}),n.device._deviceOrientationCallback(e)},_normalizeDeviceMotion:function(t){var e=t.accelerationIncludingGravity,i=e.z>0?1:-1,r={acceleration:e,rawAcceleration:"["+Math.round(e.x)+", "+Math.round(e.y)+", "+Math.round(e.z)+"]",facingUp:i,tiltLR:Math.round(e.x/9.81*-90),tiltFB:Math.round((e.y+9.81)/9.81*90*i)};n.device._deviceMotionCallback(r)},deviceOrientation:function(t){this._deviceOrientationCallback=t,n.support.deviceorientation&&(window.DeviceOrientationEvent?n.addEvent(this,window,"deviceorientation",this._normalizeDeviceOrientation):window.OrientationEvent&&n.addEvent(this,window,"MozOrientation",this._normalizeDeviceOrientation))},deviceMotion:function(t){this._deviceMotionCallback=t,n.support.devicemotion&&window.DeviceMotionEvent&&n.addEvent(this,window,"devicemotion",this._normalizeDeviceMotion)}}})},6063:t=>{t.exports={_events:{},addEvent:function(t,e,i,n){3===arguments.length&&(n=i,i=e,e=window.document);var r=t[0]||"",s=function(e){n.call(t,e)};this._events[r+e+i+n]||(this._events[r+e+i+n]=s,e.addEventListener(i,s,!1))},removeEvent:function(t,e,i,n){3===arguments.length&&(n=i,i=e,e=window.document);var r=t[0]||"",s=this._events[r+e+i+n];s&&(e.removeEventListener(i,s,!1),delete this._events[r+e+i+n])}}},7325:(t,e,i)=>{var n=i(1167);n.s("Keyboard",n.extend.call(n.extend.call(new n.__eventDispatcher,{_evt:{eventName:"",key:0,which:0,originalEvent:null},prepareEvent:function(t){var e=this._evt,i=t.type;return e.eventName="keydown"===i?"KeyDown":"keyup"===i?"KeyUp":i,e.which=null!==t.charCode?t.charCode:t.keyCode,e.key=t.keyCode||t.which,e.originalEvent=t,e},triggerKeyEvent:function(t,e){n.trigger(t,e)},dispatchEvent:function(t){var e=this.prepareEvent(t);this.triggerKey(e.eventName,e)}}),n.__keyboardStateTemplate),{},!1),n.c("Keyboard",{isDown:function(t){return n.s("Keyboard").isKeyDown(t)}})},737:(t,e,i)=>{var n=i(1167),r=window.document,s=void 0!==r.onwheel?"wheel":void 0!==r.onmousewheel?"mousewheel":"DOMMouseScroll";n._preBind("Load",(function(){n.addEvent(this,r.body,"mouseup",n.detectBlur),n.addEvent(n.s("Keyboard"),window,"blur",n.s("Keyboard").resetKeyDown),n.addEvent(n.s("Mouse"),window,"mouseup",n.s("Mouse").resetButtonDown),n.addEvent(n.s("Touch"),window,"touchend",n.s("Touch").resetTouchPoints),n.addEvent(n.s("Touch"),window,"touchcancel",n.s("Touch").resetTouchPoints),n.addEvent(n.s("Keyboard"),"keydown",n.s("Keyboard").processEvent),n.addEvent(n.s("Keyboard"),"keyup",n.s("Keyboard").processEvent),n.addEvent(n.s("Mouse"),n.stage.elem,"mousedown",n.s("Mouse").processEvent),n.addEvent(n.s("Mouse"),n.stage.elem,"mouseup",n.s("Mouse").processEvent),n.addEvent(n.s("Mouse"),n.stage.elem,"mousemove",n.s("Mouse").processEvent),n.addEvent(n.s("Mouse"),n.stage.elem,"click",n.s("Mouse").processEvent),n.addEvent(n.s("Mouse"),n.stage.elem,"dblclick",n.s("Mouse").processEvent),n.addEvent(this,n.stage.elem,"touchstart",this._touchDispatch),n.addEvent(this,n.stage.elem,"touchmove",this._touchDispatch),n.addEvent(this,n.stage.elem,"touchend",this._touchDispatch),n.addEvent(this,n.stage.elem,"touchcancel",this._touchDispatch),n.addEvent(this,n.stage.elem,"touchleave",this._touchDispatch),n.addEvent(n.s("MouseWheel"),n.stage.elem,s,n.s("MouseWheel").processEvent)})),n.bind("Pause",(function(){n.s("Keyboard").resetKeyDown(),n.s("Mouse").resetButtonDown()})),n._preBind("CraftyStop",(function(){n.s("Keyboard").resetKeyDown(),n.s("Mouse").resetButtonDown()})),n._preBind("CraftyStop",(function(){n.removeEvent(this,r.body,"mouseup",n.detectBlur),n.removeEvent(n.s("Keyboard"),window,"blur",n.s("Keyboard").resetKeyDown),n.removeEvent(n.s("Mouse"),window,"mouseup",n.s("Mouse").resetButtonDown),n.removeEvent(n.s("Touch"),window,"touchend",n.s("Touch").resetTouchPoints),n.removeEvent(n.s("Touch"),window,"touchcancel",n.s("Touch").resetTouchPoints),n.removeEvent(n.s("Keyboard"),"keydown",n.s("Keyboard").processEvent),n.removeEvent(n.s("Keyboard"),"keyup",n.s("Keyboard").processEvent),n.stage&&(n.removeEvent(n.s("Mouse"),n.stage.elem,"mousedown",n.s("Mouse").processEvent),n.removeEvent(n.s("Mouse"),n.stage.elem,"mouseup",n.s("Mouse").processEvent),n.removeEvent(n.s("Mouse"),n.stage.elem,"mousemove",n.s("Mouse").processEvent),n.removeEvent(n.s("Mouse"),n.stage.elem,"click",n.s("Mouse").processEvent),n.removeEvent(n.s("Mouse"),n.stage.elem,"dblclick",n.s("Mouse").processEvent),n.removeEvent(this,n.stage.elem,"touchstart",this._touchDispatch),n.removeEvent(this,n.stage.elem,"touchmove",this._touchDispatch),n.removeEvent(this,n.stage.elem,"touchend",this._touchDispatch),n.removeEvent(this,n.stage.elem,"touchcancel",this._touchDispatch),n.removeEvent(this,n.stage.elem,"touchleave",this._touchDispatch),n.removeEvent(n.s("MouseWheel"),n.stage.elem,s,n.s("MouseWheel").processEvent))}))},2288:(t,e,i)=>{var n=i(1167);n.s("MouseWheel",n.extend.call(new n.__eventDispatcher,{_evt:{eventName:"",direction:0,target:null,clientX:0,clientY:0,realX:0,realY:0,originalEvent:null},_mouseSystem:null,prepareEvent:function(t){var e=this._mouseSystem;e||(this._mouseSystem=e=n.s("Mouse"));var i=this._evt;return i.eventName="MouseWheelScroll",i.direction=t.detail<0||t.wheelDelta>0||t.deltaY<0?1:-1,i.clientX=void 0!==t.clientX?t.clientX:e.lastMouseEvent.clientX,i.clientY=void 0!==t.clientY?t.clientY:e.lastMouseEvent.clientY,n.translatePointerEventCoordinates(t,i),i.target=e.mouseObjs?n.findPointerEventTargetByComponent("Mouse",t):null,i.originalEvent=t,i},dispatchEvent:function(t){var e=this.prepareEvent(t);n.trigger("MouseWheelScroll",e)}}),{},!1),n.s("Mouse",n.extend.call(n.extend.call(new n.__eventDispatcher,{normedEventNames:{mousedown:"MouseDown",mouseup:"MouseUp",dblclick:"DoubleClick",click:"Click",mousemove:"MouseMove"},_evt:{eventName:"",mouseButton:-1,target:null,clientX:0,clientY:0,realX:0,realY:0,originalEvent:null},mouseObjs:0,over:null,prepareEvent:function(t){var e=this._evt,i=t.type;return e.eventName=this.normedEventNames[i]||i,void 0===t.which?e.mouseButton=t.button<2?n.mouseButtons.LEFT:4===t.button?n.mouseButtons.MIDDLE:n.mouseButtons.RIGHT:e.mouseButton=t.which<2?n.mouseButtons.LEFT:2===t.which?n.mouseButtons.MIDDLE:n.mouseButtons.RIGHT,e.clientX=t.clientX,e.clientY=t.clientY,n.translatePointerEventCoordinates(t,e),e.target=this.mouseObjs?n.findPointerEventTargetByComponent("Mouse",t):null,e.originalEvent=t,e},triggerMouseEvent:function(t,e){this.trigger(t,e);var i=this.over,n=e.target;"MouseMove"===t&&i!==n&&(i&&(e.eventName="MouseOut",e.target=i,i.trigger("MouseOut",e),e.eventName="MouseMove",e.target=n),this.over=n,n&&(e.eventName="MouseOver",n.trigger("MouseOver",e),e.eventName="MouseMove")),n&&n.trigger(t,e)},dispatchEvent:function(t){var e=this.prepareEvent(t);this.triggerMouse(e.eventName,e)}}),n.__mouseStateTemplate),{},!1),n.c("Mouse",{required:"AreaMap",init:function(){n.s("Mouse").mouseObjs++},remove:function(){n.s("Mouse").mouseObjs--}}),n.c("MouseDrag",{_dragging:!1,required:"Mouse",events:{MouseDown:"_ondown"},init:function(){this._ondown=this._ondown.bind(this),this._ondrag=this._ondrag.bind(this),this._onup=this._onup.bind(this)},_ondown:function(t){t.mouseButton===n.mouseButtons.LEFT&&this.startDrag(t)},_ondrag:function(t){if(!this._dragging||0===t.realX||0===t.realY)return!1;this.trigger("Dragging",t)},_onup:function(t){t.mouseButton===n.mouseButtons.LEFT&&this.stopDrag(t)},startDrag:function(t){if(!this._dragging)return this._dragging=!0,n.s("Mouse").bind("MouseMove",this._ondrag),n.s("Mouse").bind("MouseUp",this._onup),this.trigger("StartDrag",t||n.s("Mouse").lastMouseEvent),this},stopDrag:function(t){if(this._dragging)return this._dragging=!1,n.s("Mouse").unbind("MouseMove",this._ondrag),n.s("Mouse").unbind("MouseUp",this._onup),this.trigger("StopDrag",t||n.s("Mouse").lastMouseEvent),this}})},6541:(t,e,i)=>{var n=i(1167);n.extend({findPointerEventTargetByComponent:function(t,e,i){var r=e.target||e.srcElement||n.stage.elem;i=void 0!==i?i:e.clientY,e=void 0!==e.clientX?e.clientX:e;var s,o,a,h,u,c=null,l=-1/0;if("CANVAS"!==r.nodeName){for(;"string"!=typeof r.id&&-1===r.id.indexOf("ent");)r=r.parentNode;var d=n(parseInt(r.id.replace("ent",""),10));u=n.domHelper.translate(e,i,d._drawLayer),d.__c[t]&&d.isAt(u.x,u.y)&&(c=d)}if(!c)for(var _ in n._drawLayers){var p=n._drawLayers[_];if(!(p._pointerEntities<=0))for(u=n.domHelper.translate(e,i,p),h=0,a=(o=n.map.unfilteredSearch({_x:u.x,_y:u.y,_w:1,_h:1})).length;h<a;++h)(s=o[h])._visible&&s._drawLayer===p&&s._globalZ>l&&s.__c[t]&&s.isAt(u.x,u.y)&&(l=s._globalZ,c=s)}return c},translatePointerEventCoordinates:function(t,e){e=e||t;var i=n.domHelper.translate(t.clientX,t.clientY,void 0,this.__pointerPos);e.realX=i.x,e.realY=i.y},__pointerPos:{x:0,y:0}}),n.c("AreaMap",{init:function(){this.has("Renderable")&&this._drawLayer&&this._drawLayer._pointerEntities++},remove:function(t){!t&&this.has("Renderable")&&this._drawLayer&&this._drawLayer._pointerEntities--},events:{LayerAttached:function(t){t._pointerEntities++},LayerDetached:function(t){t._pointerEntities--}},areaMap:function(t){if(arguments.length>1){var e=Array.prototype.slice.call(arguments,0);t=new n.polygon(e)}else t=t.constructor===Array?new n.polygon(t.slice()):t.clone();return t.shift(this._x,this._y),this.mapArea=t,this.attach(this.mapArea),this.trigger("NewAreaMap",t),this}}),n.c("Button",{init:function(){var t=!n.mobile||n.mobile&&!n.multitouch()?"Mouse":"Touch";this.requires(t)}})},7411:(t,e,i)=>{var n,r,s,o=i(1167);o.extend({multitouch:function(t){return"boolean"!=typeof t?this._multitouch:(this._multitouch=t,this)},_multitouch:!1,_touchDispatch:(r=0,s=0,function(t){o._multitouch?(n||(n=o.s("Touch")),n.processEvent(t)):function(t){var e,i;"touchstart"===t.type?e="mousedown":"touchmove"===t.type?e="mousemove":("touchend"===t.type||"touchcancel"===t.type||"touchleave"===t.type)&&(e="mouseup"),t.touches&&t.touches.length?i=t.touches[0]:t.changedTouches&&t.changedTouches.length&&(i=t.changedTouches[0]);var n=document.createEvent("MouseEvent");if(n.initMouseEvent(e,!0,!0,window,1,i.screenX,i.screenY,i.clientX,i.clientY,!1,!1,!1,!1,0,t.relatedTarget),i.target.dispatchEvent(n),"mousedown"===e)r=i.clientX,s=i.clientY;else if("mouseup"===e){var o=i.clientX-r,a=i.clientY-s;o*o+a*a<=256&&(e="click",(n=document.createEvent("MouseEvent")).initMouseEvent(e,!0,!0,window,1,i.screenX,i.screenY,i.clientX,i.clientY,!1,!1,!1,!1,0,t.relatedTarget),i.target.dispatchEvent(n))}t.preventDefault()}(t)})}),o.s("Touch",o.extend.call(o.extend.call(new o.__eventDispatcher,{normedEventNames:{touchstart:"TouchStart",touchmove:"TouchMove",touchend:"TouchEnd",touchcancel:"TouchCancel"},_evt:{eventName:"",identifier:-1,target:null,entity:null,realX:0,realY:0,originalEvent:null},touchObjs:0,overs:{},prepareEvent:function(t,e){var i=this._evt;return i.eventName=this.normedEventNames[e]||e,i.identifier=t.identifier,o.translatePointerEventCoordinates(t,i),i.target=this.touchObjs?o.findPointerEventTargetByComponent("Touch",t):null,i.entity=i.target,i},triggerTouchEvent:function(t,e){this.trigger(t,e);var i=e.identifier,n=e.target,r=this.overs[i];r&&("TouchMove"===t&&r!==n||"TouchEnd"===t||"TouchCancel"===t)&&(e.eventName="TouchOut",e.target=r,e.entity=r,r.trigger("TouchOut",e),e.eventName=t,e.target=n,e.entity=n,delete this.overs[i]),n&&n.trigger(t,e),n&&("TouchStart"===t||"TouchMove"===t&&r!==n)&&(e.eventName="TouchOver",n.trigger("TouchOver",e),e.eventName=t,this.overs[i]=n)},dispatchEvent:function(t){for(var e,i=t.changedTouches,n=0,r=i.length;n<r;n++)(e=this.prepareEvent(i[n],t.type)).originalEvent=t,this.triggerTouch(e.eventName,e)}}),o.__touchStateTemplate),{},!1),o.c("Touch",{required:"AreaMap",init:function(){o.s("Touch").touchObjs++},remove:function(){o.s("Touch").touchObjs--}})},8546:(t,e,i)=>{var n=i(1167);n.__eventDispatcher=function(){},n.__eventDispatcher.prototype={processEvent:function(t){return this.dispatchEvent(t),this.preventBubbling(t)},dispatchEvent:function(t){},preventBubbling:function(t){if(n.selected&&!(8===t.key||t.key>=112&&t.key<=135))return t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,!(!t.target||"INPUT"!==t.target.nodeName&&"TEXTAREA"!==t.target.nodeName)||(t.preventDefault?t.preventDefault():t.returnValue=!1,!1)}},n.extend({selected:!0,detectBlur:function(t){var e=t.clientX>n.stage.x&&t.clientX<n.stage.x+n.viewport.width&&t.clientY>n.stage.y&&t.clientY<n.stage.y+n.viewport.height;!n.selected&&e&&n.trigger("CraftyFocus"),n.selected&&!e&&n.trigger("CraftyBlur"),n.selected=e}})},5611:(t,e,i)=>{var n=i(1167);n.extend({diamondIso:{_tile:{width:0,height:0},getTileDimensions:function(){return{w:this._tile.width,h:this._tile.height}},_map:{width:0,height:0},_origin:{x:0,y:0},_tiles:[],getTile:function(t,e,i){return this._tiles[t][e][i]},init:function(t,e,i,n,r,s){this._tile.width=parseInt(t,10),this._tile.height=parseInt(e,10)||parseInt(t,10)/2,this._tile.r=this._tile.width/this._tile.height,this._map.width=parseInt(i,10),this._map.height=parseInt(n,10)||parseInt(i,10);for(var o=0;o<i;o++){this._tiles[o]=Array();for(var a=0;a<n;a++)this._tiles[o][a]=Array()}return this.x=parseInt(r,10)||0,this.y=parseInt(s,10)||0,this.layerZLevel=i+n+1,this},place:function(t,e,i,n){var r=this.pos2px(e,i),s=t.h/this._tile.height;t.x=r.x,t.y=r.y-(s-2)*this._tile.height-this._tile.height*n,t.z=this.getZAtLoc(e,i,n);for(var o=0;o<=s-2;o++){var a=this._tiles[e][i][n+o];a&&a!==t&&a.destroy(),this._tiles[e][i][n+o]=t}return this},detachTile:function(t){for(var e=0;e<this._map.width;e++)for(var i=0;i<this._map.height;i++)for(var n=this._tiles[e][i].length,r=0;r<n;r++)if(this._tiles[e][i][r]&&t===this._tiles[e][i][r]){for(var s=t.h/this._tile.height,o=0;o<s;o++)this._tiles[e][i][r+o]=void 0;return{x:e,y:i,z:r}}return!1},centerAt:function(t,e){var i=this.pos2px(t,e);n.viewport.x=-i.x+n.viewport.width/2-this._tile.width,n.viewport.y=-i.y+n.viewport.height/2},getZAtLoc:function(t,e,i){return this.layerZLevel*i+t+e},pos2px:function(t,e){return{x:this.x+(t-e-1)*this._tile.width/2,y:this.y+(t+e)*this._tile.height/2}},px2pos:function(t,e){var i=(e-this.y)/this._tile.height,n=(t-this.x)/this._tile.width,r=i+n,s=i-n,o=r>0&&r<this._map.width,a=s>0&&s<this._map.height;if(o&&a)return{x:~~r,y:~~s}},getOverlappingTiles:function(t,e){var i=this.px2pos(t,e),n=[],r=~~i.x,s=~~i.y,o=this._map.width-r,a=this._map.height-s,h=Math.min(o,a),u=this._tiles[r][s][1];u&&n.push(u);for(var c=1;c<h;c++){var l=this._tiles[r+c][s+c][c];l&&n.push(l)}return n},polygon:function(t){t.requires("Collision");var e=[0,t.h-0-this._tile.height/2,0-this._tile.width/2,t.h-0-0,0-this._tile.width,t.h-0-this._tile.height/2,0-this._tile.width/2,t.h-0-this._tile.height];return new n.polygon(e)}}})},1534:(t,e,i)=>{var n=i(1167);n.extend({isometric:{_tile:{width:0,height:0},_elements:{},_pos:{x:0,y:0},_z:0,size:function(t,e){return this._tile.width=t,this._tile.height=e>0?e:t/2,this},place:function(t,e,i,r){var s=this.pos2px(t,e);return s.top-=i*(this._tile.height/2),r.x=s.left+n.viewport._x,r.y=s.top+n.viewport._y,r.z+=i,this},pos2px:function(t,e){return{left:t*this._tile.width+(1&e)*(this._tile.width/2),top:e*this._tile.height/2}},px2pos:function(t,e){return{x:-Math.ceil(-t/this._tile.width-.5*(1&e)),y:e/this._tile.height*2}},centerAt:function(t,e){if("number"==typeof t&&"number"==typeof e){var i=this.pos2px(t,e);return n.viewport._x=-i.left+n.viewport.width/2-this._tile.width/2,n.viewport._y=-i.top+n.viewport.height/2-this._tile.height/2,this}return{top:-n.viewport._y+n.viewport.height/2-this._tile.height/2,left:-n.viewport._x+n.viewport.width/2-this._tile.width/2}},area:function(){var t=this.centerAt(),e=this.px2pos(-t.left+n.viewport.width/2,-t.top+n.viewport.height/2),i=this.px2pos(-t.left-n.viewport.width/2,-t.top-n.viewport.height/2);return{x:{start:e.x,end:i.x},y:{start:e.y,end:i.y}}}}})},7373:(t,e,i)=>{var n=i(956)();n.extend(i(9467)),n.extend(i(6063)),i(2931),i(6013),i(9659),i(2050),i(9284),i(7132),i(9660),i(5425),i(279),i(8739),i(6867),i(5716),i(4876),i(1097),i(8832),i(2798),i(2675),i(7073),i(940),i(5611),i(1534),i(8546),i(1846),i(7325),i(737),i(2288),i(6541),i(7411),i(802),i(6717),i(7670).defineAliases(n),window&&(window.Crafty=n),t.exports=n},802:(t,e,i)=>{var n=i(1167),r=window.document;n.extend({audio:{sounds:{},supported:null,codecs:{ogg:'audio/ogg; codecs="vorbis"',wav:'audio/wav; codecs="1"',webma:'audio/webm; codecs="vorbis"',mp3:'audio/mpeg; codecs="mp3"',m4a:'audio/mp4; codecs="mp4a.40.2"'},volume:1,muted:!1,paused:!1,playCheck:null,_canPlay:function(){if(this.supported={},n.support.audio){var t,e=this.audioElement();for(var i in this.codecs)t=e.canPlayType(this.codecs[i]),this.supported[i]=""!==t&&"no"!==t}},supports:function(t){return null===this.supported&&this._canPlay(),!!this.supported[t]},audioElement:function(){return"undefined"!=typeof Audio?new Audio(""):r.createElement("audio")},create:function(t,e){var i=e.substr(e.lastIndexOf(".")+1).toLowerCase();if(!this.supports(i))return!1;var r=this.audioElement();return r.id=t,r.preload="auto",r.volume=n.audio.volume,r.src=e,n.asset(e,r),this.sounds[t]={obj:r,played:0,volume:n.audio.volume},this.sounds[t]},add:function(t,e){if(n.support.audio){var i,r;if(1===arguments.length&&"object"==typeof t)for(var s in t)for(i in t[s])if(r=n.audio.create(s,t[s][i]))break;if("string"==typeof t&&("string"==typeof e&&(r=n.audio.create(t,e)),"object"==typeof e))for(i in e)if(r=n.audio.create(t,e[i]))break;return r}},play:function(t,e,i){if(0!==e&&n.support.audio&&this.sounds[t]){var r=this.sounds[t],s=this.getOpenChannel();if(!s)return null;s.id=t,s.repeat=e;var o=s.obj;return s.volume=r.volume=r.obj.volume=i||n.audio.volume,o.volume=r.volume,o.src=r.obj.src,this.muted&&(o.volume=0),o.play(),r.played++,s.onEnd=function(){r.played<s.repeat||-1===s.repeat?(this.currentTime&&(this.currentTime=0),this.play(),r.played++):(s.active=!1,this.pause(),this.removeEventListener("ended",s.onEnd,!0),this.currentTime=0,n.trigger("SoundComplete",{id:s.id}))},o.addEventListener("ended",s.onEnd,!0),o}},maxChannels:7,setChannels:function(t){this.maxChannels=t,t<this.channels.length&&(this.channels.length=t)},channels:[],getOpenChannel:function(){for(var t=0;t<this.channels.length;t++){var e=this.channels[t];if(!1===e.active||e.obj.ended&&e.repeat<=this.sounds[e.id].played)return e.active=!0,e}if(t<this.maxChannels){var i={obj:this.audioElement(),active:!0,_is:function(t){return this.id===t&&this.active}};return this.channels.push(i),i}return null},remove:function(t){if(n.support.audio){var e,i,r=n.paths().audio;if(t)this.sounds[t]&&(i=(e=this.sounds[t]).obj.src.split("/").pop(),n.audio.stop(t),delete n.assets[r+i],delete n.assets[e.obj.src],delete n.audio.sounds[t]);else for(var s in this.sounds)i=(e=this.sounds[s]).obj.src.split("/").pop(),n.audio.stop(t),delete n.assets[r+i],delete n.assets[e.obj.src],delete n.audio.sounds[t]}},stop:function(t){var e;if(n.support.audio)for(var i in this.channels)e=this.channels[i],(!t&&e.active||e._is(t))&&(e.active=!1,e.obj.pause())},_mute:function(t){if(n.support.audio){var e;for(var i in this.channels)(e=this.channels[i]).obj.volume=t?0:e.volume;this.muted=t}},toggleMute:function(){this.muted?this._mute(!1):this._mute(!0)},mute:function(){this._mute(!0)},unmute:function(){this._mute(!1)},pause:function(t){var e;if(n.support.audio&&t&&this.sounds[t])for(var i in this.channels)(e=this.channels[i])._is(t)&&!e.obj.paused&&e.obj.pause()},unpause:function(t){var e;if(n.support.audio&&t&&this.sounds[t])for(var i in this.channels)(e=this.channels[i])._is(t)&&e.obj.paused&&e.obj.play()},togglePause:function(t){var e;if(n.support.audio&&t&&this.sounds[t])for(var i in this.channels)(e=this.channels[i])._is(t)&&(e.obj.paused?e.obj.play():e.obj.pause())},isPlaying:function(t){if(!n.support.audio)return!1;for(var e in this.channels)if(this.channels[e]._is(t))return!0;return!1}}})},9600:(t,e,i)=>{var n=i(1167),r=Math.PI/180;n.c("2D",{_x:0,_y:0,_w:0,_h:0,_z:0,_globalZ:null,_rotation:0,_origin:null,_mbr:null,_entry:null,_children:null,_parent:null,properties:{x:{set:function(t){this._setter2d("_x",t)},get:function(){return this._x},configurable:!0,enumerable:!0},_x:{enumerable:!1},y:{set:function(t){this._setter2d("_y",t)},get:function(){return this._y},configurable:!0,enumerable:!0},_y:{enumerable:!1},w:{set:function(t){this._setter2d("_w",t)},get:function(){return this._w},configurable:!0,enumerable:!0},_w:{enumerable:!1},h:{set:function(t){this._setter2d("_h",t)},get:function(){return this._h},configurable:!0,enumerable:!0},_h:{enumerable:!1},z:{set:function(t){this._setter2d("_z",t)},get:function(){return this._z},configurable:!0,enumerable:!0},_z:{enumerable:!1},rotation:{set:function(t){this._setter2d("_rotation",t)},get:function(){return this._rotation},configurable:!0,enumerable:!0},_rotation:{enumerable:!1},ox:{set:function(t){var e=t-this._origin.x;this._setter2d("_x",e)},get:function(){return this._x+this._origin.x},configurable:!0,enumerable:!0},oy:{set:function(t){var e=t-this._origin.y;this._setter2d("_y",e)},get:function(){return this._y+this._origin.y},configurable:!0,enumerable:!0}},init:function(){this._globalZ=this[0],this._origin={x:0,y:0},this._bx1=0,this._bx2=0,this._by1=0,this._by2=0,this._children=[],this._entry=n.map.insert(this),this.bind("Move",(function(t){var e=this._cbr||this._mbr||this;this._entry.update(e),this._children.length>0&&this._cascade(t)})),this.bind("Rotate",(function(t){var e=this._cbr||this._mbr||this;this._entry.update(e),this._children.length>0&&this._cascadeRotation(t)})),this.bind("Remove",(function(){if(this._children){for(var t=0;t<this._children.length;t++)delete this._children[t]._parent,this._children[t].destroy&&this._children[t].destroy();this._children=[]}this._parent&&this._parent.detach(this),n.map.remove(this._entry),this.detach()}))},events:{Freeze:function(){n.map.remove(this._entry)},Unfreeze:function(){this._entry=n.map.insert(this,this._entry)}},offsetBoundary:function(t,e,i,n){return 1===arguments.length&&(e=i=n=t),this._bx1=t,this._bx2=i,this._by1=e,this._by2=n,this.trigger("BoundaryOffset"),this._calculateMBR(),this},_calculateMBR:function(){var t=this._origin.x+this._x,e=this._origin.y+this._y,i=-this._rotation*r,n=this._x-this._bx1-t,s=this._x+this._w+this._bx2-t,o=this._y-this._by1-e,a=this._y+this._h+this._by2-e,h=Math.cos(i),u=Math.sin(i),c=n*(h=h<1e-10&&h>-1e-10?0:h)+o*(u=u<1e-10&&u>-1e-10?0:u),l=-n*u+o*h,d=s*h+o*u,_=-s*u+o*h,p=s*h+a*u,f=-s*u+a*h,g=n*h+a*u,v=-n*u+a*h,y=Math.floor(Math.min(c,d,p,g)+t),m=Math.floor(Math.min(l,_,f,v)+e),w=Math.ceil(Math.max(c,d,p,g)+t),x=Math.ceil(Math.max(l,_,f,v)+e);if(this._mbr?(this._mbr._x=y,this._mbr._y=m,this._mbr._w=w-y,this._mbr._h=x-m):this._mbr={_x:y,_y:m,_w:w-y,_h:x-m},this._cbr){var b=this._cbr,M=b.cx,T=b.cy,D=b.r,C=t+(M+this._x-t)*h+(T+this._y-e)*u,E=e-(M+this._x-t)*u+(T+this._y-e)*h;b._x=Math.min(C-D,y),b._y=Math.min(E-D,m),b._w=Math.max(C+D,w)-b._x,b._h=Math.max(E+D,x)-b._y}},_rotate:function(t){var e=this._rotation-t;0!==e&&(this._rotation=t,this._calculateMBR(),this.trigger("Rotate",e))},area:function(){return this._w*this._h},intersect:function(t,e,i,n){var r,s=this._mbr||this;return r="object"==typeof t?t:{_x:t,_y:e,_w:i,_h:n},s._x<r._x+r._w&&s._x+s._w>r._x&&s._y<r._y+r._h&&s._y+s._h>r._y},within:function(t,e,i,n){var r,s=this._mbr||this;return(r="object"==typeof t?t:{_x:t,_y:e,_w:i,_h:n})._x<=s._x&&r._x+r._w>=s._x+s._w&&r._y<=s._y&&r._y+r._h>=s._y+s._h},contains:function(t,e,i,n){var r,s=this._mbr||this;return(r="object"==typeof t?t:{_x:t,_y:e,_w:i,_h:n})._x>=s._x&&r._x+r._w<=s._x+s._w&&r._y>=s._y&&r._y+r._h<=s._y+s._h},pos:function(t){return(t=t||{})._x=this._x,t._y=this._y,t._w=this._w,t._h=this._h,t},mbr:function(t){return t=t||{},this._mbr?(t._x=this._mbr._x,t._y=this._mbr._y,t._w=this._mbr._w,t._h=this._mbr._h,t):this.pos(t)},isAt:function(t,e){if(this.mapArea)return this.mapArea.containsPoint(t,e);if(this.map)return this.map.containsPoint(t,e);var i=this._mbr||this;return i._x<=t&&i._x+i._w>=t&&i._y<=e&&i._y+i._h>=e},move:function(t,e){return"n"===t.charAt(0)&&(this.y-=e),"s"===t.charAt(0)&&(this.y+=e),"e"!==t&&"e"!==t.charAt(1)||(this.x+=e),"w"!==t&&"w"!==t.charAt(1)||(this.x-=e),this},shift:function(t,e,i,n){return(t||e)&&this._setPosition(this._x+t,this._y+e),i&&(this.w+=i),n&&(this.h+=n),this},_cascade:function(t){if(t)for(var e,i=0,n=this._children,r=n.length,s=this._x-t._x,o=this._y-t._y,a=this._w-t._w,h=this._h-t._h;i<r;++i)(e=n[i]).__frozen||e.shift(s,o,a,h)},_cascadeRotation:function(t){if(t){var e,i=0,n=this._children,s=n.length,o=t*r,a=Math.cos(o),h=Math.sin(o);a=-1e-10<a&&a<1e-10?0:a,h=-1e-10<h&&h<1e-10?0:h;for(var u=this._origin.x+this._x,c=this._origin.y+this._y;i<s;++i)(e=n[i]).__frozen||"rotate"in e&&e.rotate(t,u,c,a,h)}},attach:function(){for(var t,e=0,i=arguments,n=arguments.length;e<n;++e)(t=i[e])._parent&&t._parent.detach(t),t._parent=this,this._children.push(t);return this},detach:function(t){var e;if(!t){for(e=0;e<this._children.length;e++)this._children[e]._parent=null;return this._children=[],this}for(e=0;e<this._children.length;e++)this._children[e]===t&&this._children.splice(e,1);return t._parent=null,this},origin:function(t,e){if("string"==typeof t)if("centre"===t||"center"===t||-1===t.indexOf(" "))t=this._w/2,e=this._h/2;else{var i=t.split(" ");"top"===i[0]?e=0:"bottom"===i[0]?e=this._h:"middle"!==i[0]&&"center"!==i[1]&&"centre"!==i[1]||(e=this._h/2),"center"===i[1]||"centre"===i[1]||"middle"===i[1]?t=this._w/2:"left"===i[1]?t=0:"right"===i[1]&&(t=this._w)}return this._origin.x=t,this._origin.y=e,this.trigger("OriginChanged"),this},rotate:function(t,e,i,n,r){var s,o;s=(this._x+this._origin.x-e)*n+(this._y+this._origin.y-i)*r+(e-this._origin.x),o=(this._y+this._origin.y-i)*n-(this._x+this._origin.x-e)*r+(i-this._origin.y),this._setter2d("_rotation",this._rotation-t),this._setter2d("_x",s),this._setter2d("_y",o)},_setPosition:function(t,e){if(t!==this._x||e!==this._y){var i=n.rectManager._pool.copy(this),r=this._mbr;r&&(r._x-=this._x-t,r._y-=this._y-e,this._cbr&&(this._cbr._x-=this._x-t,this._cbr._y-=this._y-e)),this._x=t,this._y=e,this.trigger("Move",i),this.trigger("Invalidate"),n.rectManager._pool.recycle(i)}},_setter2d:function(t,e){if(this[t]!==e){var i,r=n.rectManager._pool.copy(this);if("_rotation"===t)this._rotate(e);else if("_x"===t||"_y"===t)(i=this._mbr)&&(i[t]-=this[t]-e,this._cbr&&(this._cbr[t]-=this[t]-e)),this[t]=e,this.trigger("Move",r);else if("_h"===t||"_w"===t){i=this._mbr;var s=this[t];this[t]=e,i&&this._calculateMBR(),"_w"===t?this.trigger("Resize",{axis:"w",amount:e-s}):"_h"===t&&this.trigger("Resize",{axis:"h",amount:e-s}),this.trigger("Move",r)}else if("_z"===t){var o=e<<0;e=e===o?o:o+1,this._globalZ=1e5*e+this[0],this[t]=e,this.trigger("Reorder")}this[t]=e,this.trigger("Invalidate"),n.rectManager._pool.recycle(r)}}}),n.polygon=function(t){arguments.length>1&&(t=Array.prototype.slice.call(arguments,0)),this.points=t},n.polygon.prototype={containsPoint:function(t,e){var i,n,r=this.points,s=r.length/2,o=!1;for(i=0,n=s-1;i<s;n=i++)r[2*i+1]>e!=r[2*n+1]>e&&t<(r[2*n]-r[2*i])*(e-r[2*i+1])/(r[2*n+1]-r[2*i+1])+r[2*i]&&(o=!o);return o},shift:function(t,e){for(var i=0,n=this.points,r=n.length;i<r;i+=2)n[i]+=t,n[i+1]+=e},clone:function(){return new n.polygon(this.points.slice(0))},rotate:function(t,e,i,n,r){for(var s,o,a=0,h=this.points,u=h.length;a<u;a+=2)s=e+(h[a]-e)*n+(h[a+1]-i)*r,o=i-(h[a]-e)*r+(h[a+1]-i)*n,h[a]=s,h[a+1]=o},intersectRay:function(t,e){for(var i,n,r,s,o,a,h,u,c,l=this.points,d=1/0,_=t._x,p=e.x,f=t._y,g=e.y,v=0,y=l.length,m=l[y-2],w=l[y-1];v<y;v+=2)a=l[v],n=(m-_)*(c=(u=l[v+1])-w)-(w-f)*(h=a-m),s=(m-_)*g-(w-f)*p,0!=(o=p*c-g*h)?(i=n/o,(r=s/o)>=0&&r<=1&&i>=0&&i<d&&(d=i)):0!==n&&0!==s||((i=(m-_)*p+(w-f)*g)>=0&&i<d&&(d=i),(i=(a-_)*p+(u-f)*g)>=0&&i<d&&(d=i)),m=a,w=u;return d}},n.circle=function(t,e,i){var n;this.x=t,this.y=e,this.radius=i,this.points=[];for(var r=0;r<16;r+=2)n=r*Math.PI/8,this.points[r]=this.x+Math.sin(n)*i,this.points[r+1]=this.y+Math.cos(n)*i},n.circle.prototype={containsPoint:function(t,e){var i=this.radius,n=this.x-t,r=this.y-e;return n*n+r*r<i*i},shift:function(t,e){this.x+=t,this.y+=e;for(var i=0,n=this.points,r=n.length;i<r;i+=2)n[i]+=t,n[i+1]+=e},rotate:function(){}},n.matrix=function(t){this.mtx=t,this.width=t[0].length,this.height=t.length},n.matrix.prototype={x:function(t){if(this.width===t.height){for(var e=[],i=0;i<this.height;i++){e[i]=[];for(var r=0;r<t.width;r++){for(var s=0,o=0;o<this.width;o++)s+=this.mtx[i][o]*t.mtx[o][r];e[i][r]=s}}return new n.matrix(e)}},e:function(t,e){return t<1||t>this.mtx.length||e<1||e>this.mtx[0].length?null:this.mtx[t-1][e-1]}}},8688:(t,e,i)=>{var n=i(1167),r=Math.PI/180,s=1e-6;n.extend({raycast:function(t,e){for(var i,r,o="obj",a=1/0,h=!0,u=2,c=arguments.length;u<c;++u)"number"==(r=typeof(i=arguments[u]))?a=i+s:"string"===r?o=i:"boolean"===r&&(h=i);var l=t._x,d=t._y,_=e.x,p=e.y,f={},g=[];if(a<0){var v=null,y=1/0;n.map.traverseRay(t,e,(function(i,n){if(v&&y<n)return g.push({obj:v,distance:y,x:l+y*_,y:d+y*p}),v=null,y=1/0,!0;if(i.map&&i.__c[o]&&!f[i[0]]){f[i[0]]=!0;var r=i.map.intersectRay(t,e);r<y&&(v=i,y=r)}})),v&&g.push({obj:v,distance:y,x:l+y*_,y:d+y*p})}else n.map.traverseRay(t,e,(function(i,n){if(n>a)return!0;if(i.map&&i.__c[o]&&!f[i[0]]){f[i[0]]=!0;var r=i.map.intersectRay(t,e);r<a&&g.push({obj:i,distance:r,x:l+r*_,y:d+r*p})}}));return h&&g.sort((function(t,e){return t.distance-e.distance})),g}}),n.c("Collision",{init:function(){this.requires("2D"),this._collisionData={},this.collision()},remove:function(){this._cbr=null,this.unbind("Resize",this._resizeMap),this.unbind("Resize",this._checkBounds)},collision:function(t){if(this.unbind("Resize",this._resizeMap),this.unbind("Resize",this._checkBounds),t){if(arguments.length>1){var e=Array.prototype.slice.call(arguments,0);t=new n.polygon(e)}else t=t.constructor===Array?new n.polygon(t.slice()):t.clone();this._findBounds(t.points)}else t=new n.polygon([0,0,this._w,0,this._w,this._h,0,this._h]),this.bind("Resize",this._resizeMap),this._cbr=null;return this.rotation&&t.rotate(this.rotation,this._origin.x,this._origin.y,Math.cos(-this.rotation*r),Math.sin(-this.rotation*r)),this.map=t,this.attach(this.map),this.map.shift(this._x,this._y),this.trigger("NewHitbox",t),this},cbr:function(t){return t=t||{},this._cbr?(t._x=this._cbr._x,t._y=this._cbr._y,t._w=this._cbr._w,t._h=this._cbr._h,t):this.mbr(t)},_findBounds:function(t){for(var e=1/0,i=-1/0,n=1/0,r=-1/0,s=t.length,o=0;o<s;o+=2)t[o]<e&&(e=t[o]),t[o]>i&&(i=t[o]),t[o+1]<n&&(n=t[o+1]),t[o+1]>r&&(r=t[o+1]);var a={cx:(e+i)/2,cy:(n+r)/2,r:Math.sqrt((i-e)*(i-e)+(r-n)*(r-n))/2};return e>=0&&n>=0&&(this._checkBounds=function(){null===this._cbr&&this._w<i||this._h<r?(this._cbr=a,this._calculateMBR()):this._cbr&&(this._cbr=null,this._calculateMBR())},this.bind("Resize",this._checkBounds)),e>=0&&n>=0&&i<=this._w&&r<=this._h?(this._cbr=null,!1):(this._cbr=a,this._calculateMBR(),!0)},_resizeMap:function(t){var e,i,n=this.rotation*r,s=this.map.points;"w"===t.axis?(n?(e=t.amount*Math.cos(n),i=t.amount*Math.sin(n)):(e=t.amount,i=0),s[2]+=e,s[3]+=i):(n?(i=t.amount*Math.cos(n),e=-t.amount*Math.sin(n)):(e=0,i=t.amount),s[6]+=e,s[7]+=i),s[4]+=e,s[5]+=i},_collisionHitDupes:[],_collisionHitResults:[],hit:function(t,e){var i=this._cbr||this._mbr||this,r=this._collisionHitResults;r.length=0;var s=(r=n.map.unfilteredSearch(i,r)).length;if(!s)return null;var o,a,h=0,u=this._collisionHitDupes;for(e=e||[],u.length=0;h<s;++h)if((a=r[h])&&!u[o=a[0]]&&this[0]!==o&&a.__c[t])if(u[o]=a,a.map){var c=this._SAT(this.map,a.map);c&&(e.push(c),c.obj=a,c.type="SAT")}else n.rectManager.overlap(i,a._cbr||a._mbr||a)&&e.push({obj:a,type:"MBR"});return e.length?e:null},onHit:function(t,e,i){var n=!1;return this.bind("UpdateFrame",(function(){var r=this.hit(t);r?(e.call(this,r,!n),n=!0):n&&("function"==typeof i&&i.call(this),n=!1)})),this},_createCollisionHandler:function(t,e){return function(){var i=this.hit(t);if(!0===e.occurring){if(null!==i)return;e.occurring=!1,this.trigger("HitOff",t)}else null!==i&&(e.occurring=!0,this.trigger("HitOn",i))}},checkHits:function(){var t=arguments,e=0;for(1===t.length&&(t=t[0].split(/\s*,\s*/));e<t.length;++e){var i=t[e],n=this._collisionData[i];void 0===n&&(this._collisionData[i]=n={occurring:!1,handler:null},n.handler=this._createCollisionHandler(i,n),this.bind("UpdateFrame",n.handler))}return this},ignoreHits:function(){var t,e=arguments,i=0;if(0===e.length){for(t in this._collisionData)this.unbind("UpdateFrame",t.handler);this._collisionData={}}for(1===e.length&&(e=e[0].split(/\s*,\s*/));i<e.length;++i){var n=e[i];void 0!==(t=this._collisionData[n])&&(this.unbind("UpdateFrame",t.handler),delete this._collisionData[n])}return this},resetHitChecks:function(){var t,e=arguments,i=0;if(0===e.length)for(t in this._collisionData)this._collisionData[t].occurring=!1;for(1===e.length&&(e=e[0].split(/\s*,\s*/));i<e.length;++i){var n=e[i];void 0!==(t=this._collisionData[n])&&(t.occurring=!1)}return this},_SAT:function(t,e){for(var i,n,r,s,o,a,h,u,c,l=0,d=t.points,_=e.points,p=d.length/2,f=_.length/2,g=0,v=0,y=-1/0,m=null,w=null;l<p;l++){for(c=l===p-1?0:l+1,g=-(d[2*l+1]-d[2*c+1]),v=d[2*l]-d[2*c],g/=n=Math.sqrt(g*g+v*v),v/=n,r=s=1/0,o=a=-1/0,i=0;i<p;++i)(u=d[2*i]*g+d[2*i+1]*v)>o&&(o=u),u<r&&(r=u);for(i=0;i<f;++i)(u=_[2*i]*g+_[2*i+1]*v)>a&&(a=u),u<s&&(s=u);if(r<s?(h=s-o,g=-g,v=-v):h=r-a,h>=0)return!1;h>y&&(y=h,m=g,w=v)}for(l=0;l<f;l++){for(c=l===f-1?0:l+1,g=-(_[2*l+1]-_[2*c+1]),v=_[2*l]-_[2*c],g/=n=Math.sqrt(g*g+v*v),v/=n,r=s=1/0,o=a=-1/0,i=0;i<p;++i)(u=d[2*i]*g+d[2*i+1]*v)>o&&(o=u),u<r&&(r=u);for(i=0;i<f;++i)(u=_[2*i]*g+_[2*i+1]*v)>a&&(a=u),u<s&&(s=u);if(r<s?(h=s-o,g=-g,v=-v):h=r-a,h>=0)return!1;h>y&&(y=h,m=g,w=v)}return{overlap:y,nx:m,ny:w}}})},9689:(t,e,i)=>{var n=i(1167);n.math={abs:function(t){return t<0?-t:t},amountOf:function(t,e,i){return e<i?(t-e)/(i-e):(t-i)/(e-i)},clamp:function(t,e,i){return t>i?i:t<e?e:t},degToRad:function(t){return t*Math.PI/180},distance:function(t,e,i,r){var s=n.math.squaredDistance(t,e,i,r);return Math.sqrt(parseFloat(s))},lerp:function(t,e,i){return t+(e-t)*i},negate:function(t){return Math.random()<t?-1:1},radToDeg:function(t){return 180*t/Math.PI},randomElementOfArray:function(t){return t[Math.floor(t.length*Math.random())]},randomInt:function(t,e){return t+Math.floor((1+e-t)*Math.random())},randomNumber:function(t,e){return t+(e-t)*Math.random()},squaredDistance:function(t,e,i,n){return(t-i)*(t-i)+(e-n)*(e-n)},withinRange:function(t,e,i){return t>=e&&t<=i}},n.math.Vector2D=function(){function t(e,i){if(e instanceof t)this.x=e.x,this.y=e.y;else if(2===arguments.length)this.x=e,this.y=i;else if(arguments.length>0)throw"Unexpected number of arguments for Vector2D()"}return t.prototype.x=0,t.prototype.y=0,t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},t.prototype.angleBetween=function(t){return Math.atan2(this.x*t.y-this.y*t.x,this.x*t.x+this.y*t.y)},t.prototype.angleTo=function(t){return Math.atan2(t.y-this.y,t.x-this.x)},t.prototype.clone=function(){return new t(this)},t.prototype.distance=function(t){return Math.sqrt((t.x-this.x)*(t.x-this.x)+(t.y-this.y)*(t.y-this.y))},t.prototype.distanceSq=function(t){return(t.x-this.x)*(t.x-this.x)+(t.y-this.y)*(t.y-this.y)},t.prototype.divide=function(t){return this.x/=t.x,this.y/=t.y,this},t.prototype.dotProduct=function(t){return this.x*t.x+this.y*t.y},t.prototype.crossProduct=function(t){return this.x*t.y-this.y*t.x},t.prototype.equals=function(e){return e instanceof t&&this.x===e.x&&this.y===e.y},t.prototype.perpendicular=function(e){return(e=e||new t).setValues(-this.y,this.x)},t.prototype.getNormal=function(e,i){return(i=i||new t).setValues(e.y-this.y,this.x-e.x).normalize()},t.prototype.isZero=function(){return 0===this.x&&0===this.y},t.prototype.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},t.prototype.magnitudeSq=function(){return this.x*this.x+this.y*this.y},t.prototype.multiply=function(t){return this.x*=t.x,this.y*=t.y,this},t.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},t.prototype.normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y);return 0===t?(this.x=1,this.y=0):(this.x/=t,this.y/=t),this},t.prototype.scale=function(t,e){return void 0===e&&(e=t),this.x*=t,this.y*=e,this},t.prototype.scaleToMagnitude=function(t){var e=t/this.magnitude();return this.x*=e,this.y*=e,this},t.prototype.setValues=function(e,i){return e instanceof t?(this.x=e.x,this.y=e.y):(this.x=e,this.y=i),this},t.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},t.prototype.toString=function(){return"Vector2D("+this.x+", "+this.y+")"},t.prototype.translate=function(t,e){return void 0===e&&(e=t),this.x+=t,this.y+=e,this},t.tripleProduct=function(t,e,i,r){r=r||new n.math.Vector2D;var s=t.dotProduct(i),o=e.dotProduct(i);return r.setValues(e.x*s-t.x*o,e.y*s-t.y*o)},t}(),n.math.Matrix2D=function(){function t(e,i,n,r,s,o){if(e instanceof t)this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.e=e.e,this.f=e.f;else if(6===arguments.length)this.a=e,this.b=i,this.c=n,this.d=r,this.e=s,this.f=o;else if(arguments.length>0)throw"Unexpected number of arguments for Matrix2D()"}return t.prototype.a=1,t.prototype.b=0,t.prototype.c=0,t.prototype.d=1,t.prototype.e=0,t.prototype.f=0,t.prototype.apply=function(t){var e=t.x;return t.x=e*this.a+t.y*this.c+this.e,t.y=e*this.b+t.y*this.d+this.f,t},t.prototype.clone=function(){return new t(this)},t.prototype.combine=function(t){var e=this.a;return this.a=e*t.a+this.b*t.c,this.b=e*t.b+this.b*t.d,e=this.c,this.c=e*t.a+this.d*t.c,this.d=e*t.b+this.d*t.d,e=this.e,this.e=e*t.a+this.f*t.c+t.e,this.f=e*t.b+this.f*t.d+t.f,this},t.prototype.equals=function(e){return e instanceof t&&this.a===e.a&&this.b===e.b&&this.c===e.c&&this.d===e.d&&this.e===e.e&&this.f===e.f},t.prototype.determinant=function(){return this.a*this.d-this.b*this.c},t.prototype.invert=function(){var t=this.determinant();if(0!==t){var e={a:this.a,b:this.b,c:this.c,d:this.d,e:this.e,f:this.f};this.a=e.d/t,this.b=-e.b/t,this.c=-e.c/t,this.d=e.a/t,this.e=(e.c*e.f-e.e*e.d)/t,this.f=(e.e*e.b-e.a*e.f)/t}return this},t.prototype.isIdentity=function(){return 1===this.a&&0===this.b&&0===this.c&&1===this.d&&0===this.e&&0===this.f},t.prototype.isInvertible=function(){return 0!==this.determinant()},t.prototype.preRotate=function(t){var e=Math.cos(t),i=Math.sin(t),n=this.a;return this.a=e*n-i*this.b,this.b=i*n+e*this.b,n=this.c,this.c=e*n-i*this.d,this.d=i*n+e*this.d,this},t.prototype.preScale=function(t,e){return void 0===e&&(e=t),this.a*=t,this.b*=e,this.c*=t,this.d*=e,this},t.prototype.preTranslate=function(t,e){return"number"==typeof t?(this.e+=t,this.f+=e):(this.e+=t.x,this.f+=t.y),this},t.prototype.rotate=function(t){var e=Math.cos(t),i=Math.sin(t),n=this.a;return this.a=e*n-i*this.b,this.b=i*n+e*this.b,n=this.c,this.c=e*n-i*this.d,this.d=i*n+e*this.d,n=this.e,this.e=e*n-i*this.f,this.f=i*n+e*this.f,this},t.prototype.scale=function(t,e){return void 0===e&&(e=t),this.a*=t,this.b*=e,this.c*=t,this.d*=e,this.e*=t,this.f*=e,this},t.prototype.setValues=function(e,i,n,r,s,o){return e instanceof t?(this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.e=e.e,this.f=e.f):(this.a=e,this.b=i,this.c=n,this.d=r,this.e=s,this.f=o),this},t.prototype.toString=function(){return"Matrix2D(["+this.a+", "+this.c+", "+this.e+"] ["+this.b+", "+this.d+", "+this.f+"] [0, 0, 1])"},t.prototype.translate=function(t,e){return"number"==typeof t?(this.e+=this.a*t+this.c*e,this.f+=this.b*t+this.d*e):(this.e+=this.a*t.x+this.c*t.y,this.f+=this.b*t.x+this.d*t.y),this},t}()},8087:(t,e,i)=>{var n=i(1167),r=function(t,e,i,r){var s=e+i,o="_"+s,a={key:"",oldValue:0};r?n.defineField(t,s,(function(){return this[o]}),(function(t){var e=this[o];t!==e&&(this[o]=t,a.key=s,a.oldValue=e,this.trigger("MotionChange",a))})):n.defineField(t,s,(function(){return this[o]}),(function(t){})),Object.defineProperty(t,o,{value:0,writable:!0,enumerable:!1,configurable:!1})},s=function(t,e,i,r){var s=e+"x",o=e+"y",a="_"+s,h="_"+o;return i?(n.defineField(r,"x",(function(){return t[a]}),(function(e){t[s]=e})),n.defineField(r,"y",(function(){return t[h]}),(function(e){t[o]=e}))):(n.defineField(r,"x",(function(){return t[a]}),(function(t){})),n.defineField(r,"y",(function(){return t[h]}),(function(t){}))),Object.seal&&Object.seal(r),r};n.c("AngularMotion",{_vrotation:0,_arotation:0,_drotation:0,init:function(){this.requires("2D"),r(this,"v","rotation",!0),r(this,"a","rotation",!0),r(this,"d","rotation",!1),this.__oldRotationDirection=0,this.bind("UpdateFrame",this._angularMotionTick)},remove:function(t){this.unbind("UpdateFrame",this._angularMotionTick)},resetAngularMotion:function(){return this._drotation=0,this.vrotation=0,this.arotation=0,this},_angularMotionTick:function(t){var e=t.dt/1e3,i=this._rotation,n=this._vrotation,r=this._arotation,s=i+n*e+.5*r*e*e;this.vrotation=n+r*e;var o=this._vrotation,a=o?o<0?-1:1:0;this.__oldRotationDirection!==a&&(this.__oldRotationDirection=a,this.trigger("NewRotationDirection",a)),this._drotation=s-i,0!==this._drotation&&(this.rotation=s,this.trigger("Rotated",i))}}),n.c("Motion",{_vx:0,_vy:0,_ax:0,_ay:0,_dx:0,_dy:0,init:function(){this.requires("2D"),r(this,"v","x",!0),r(this,"v","y",!0),this._velocity=s(this,"v",!0,new n.math.Vector2D),r(this,"a","x",!0),r(this,"a","y",!0),this._acceleration=s(this,"a",!0,new n.math.Vector2D),r(this,"d","x",!1),r(this,"d","y",!1),this._motionDelta=s(this,"d",!1,new n.math.Vector2D),this.__oldDirection={x:0,y:0},this.bind("UpdateFrame",this._linearMotionTick)},remove:function(t){this.unbind("UpdateFrame",this._linearMotionTick)},resetMotion:function(){return this.vx=0,this.vy=0,this.ax=0,this.ay=0,this._dx=0,this._dy=0,this},motionDelta:function(){return this._motionDelta},velocity:function(){return this._velocity},acceleration:function(){return this._acceleration},ccdbr:function(t){var e=this._cbr||this._mbr||this,i=this._dx,n=this._dy,r=0,s=0,o=i>0?r=i:-i,a=n>0?s=n:-n;return(t=t||{})._x=e._x-r,t._y=e._y-s,t._w=e._w+o,t._h=e._h+a,t},_linearMotionTick:function(t){var e=t.dt/1e3,i=this._vx,n=this._ax,r=this._vy,s=this._ay,o=i*e+.5*n*e*e,a=r*e+.5*s*e*e;this.vx=i+n*e,this.vy=r+s*e;var h=this.__oldDirection,u=this._vx,c=u?u<0?-1:1:0,l=this._vy,d=l?l<0?-1:1:0;h.x===c&&h.y===d||(h.x=c,h.y=d,this.trigger("NewDirection",h)),this._dx=o,this._dy=a,this._setPosition(this._x+o,this._y+a)}})},2377:(t,e,i)=>{var n=i(1167);n.c("Supportable",{_ground:null,_groundComp:null,_preventGroundTunneling:!1,canLand:!0,init:function(){this.requires("2D"),this.__area={_x:0,_y:0,_w:0,_h:0},this.defineField("ground",(function(){return this._ground}),(function(t){}))},remove:function(t){this.unbind("UpdateFrame",this._detectGroundTick)},startGroundDetection:function(t){return t&&(this._groundComp=t),this.uniqueBind("UpdateFrame",this._detectGroundTick),this},stopGroundDetection:function(){return this.unbind("UpdateFrame",this._detectGroundTick),this},preventGroundTunneling:function(t){return void 0===t&&(t=!0),t&&this.requires("Motion"),this._preventGroundTunneling=t,this},_detectGroundTick:function(){var t,e=this._groundComp,i=this._ground,r=n.rectManager.overlap;if(this._preventGroundTunneling)t=this.ccdbr(this.__area);else{var s=this._cbr||this._mbr||this;(t=this.__area)._x=s._x,t._y=s._y,t._w=s._w,t._h=s._h}if(t._h++,i){var o=i._cbr||i._mbr||i;i.__c[e]&&n(i[0])===i&&r(o,t)||(this._ground=null,this.trigger("LiftedOffGround",i),i=null)}if(!i)for(var a,h,u=n.map.unfilteredSearch(t),c=0,l=u.length;c<l;++c)if(h=(a=u[c])._cbr||a._mbr||a,a!==this&&a.__c[e]&&r(h,t)&&(this.canLand=!0,this.trigger("CheckLanding",a),this.canLand)){this._ground=i=a,this.y=i._y-this._h,this._x>i._x+i._w?this.x=i._x+i._w-1:this._x+this._w<i._x&&(this.x=i._x-this._w+1),this.trigger("LandedOnGround",i);break}}}),n.c("GroundAttacher",{_groundAttach:function(t){t.attach(this)},_groundDetach:function(t){t.detach(this)},init:function(){this.requires("Supportable"),this.bind("LandedOnGround",this._groundAttach),this.bind("LiftedOffGround",this._groundDetach)},remove:function(t){this.unbind("LandedOnGround",this._groundAttach),this.unbind("LiftedOffGround",this._groundDetach)}}),n.c("Gravity",{_gravityConst:500,_gravityActive:!1,init:function(){this.requires("2D, Supportable, Motion"),this.bind("LiftedOffGround",this._startGravity),this.bind("LandedOnGround",this._stopGravity)},remove:function(t){this.unbind("LiftedOffGround",this._startGravity),this.unbind("LandedOnGround",this._stopGravity)},_gravityCheckLanding:function(t){this._dy<0&&(this.canLand=!1)},gravity:function(t){return this.uniqueBind("CheckLanding",this._gravityCheckLanding),this.startGroundDetection(t),this._startGravity(),this},antigravity:function(){return this._stopGravity(),this.stopGroundDetection(),this.unbind("CheckLanding",this._gravityCheckLanding),this},gravityConst:function(t){return this._gravityActive&&(this.ay-=this._gravityConst,this.ay+=t),this._gravityConst=t,this},_startGravity:function(){this._gravityActive||(this._gravityActive=!0,this.ay+=this._gravityConst)},_stopGravity:function(){this._gravityActive&&(this._gravityActive=!1,this.ay=0,this.vy=0)}})},2609:(t,e,i)=>{var n,r;i(1167).extend({rectManager:{merge:function(t,e,i){return void 0===i&&(i={}),i._h=Math.max(t._y+t._h,e._y+e._h),i._w=Math.max(t._x+t._w,e._x+e._w),i._x=Math.min(t._x,e._x),i._y=Math.min(t._y,e._y),i._w-=i._x,i._h-=i._y,i},overlap:function(t,e){return t._x<e._x+e._w&&t._x+t._w>e._x&&t._y<e._y+e._h&&t._y+t._h>e._y},integerBounds:function(t){return t._x=Math.floor(t._x),t._y=Math.floor(t._y),t._w=Math.ceil(t._w),t._h=Math.ceil(t._h),t},mergeSet:function(t){if(t.length<2)return t;for(var e=t.length-1;e--;)this.overlap(t[e],t[e+1])&&(this.merge(t[e],t[e+1],t[e]),t.splice(e+1,1));return t},boundingRect:function(t){if(t&&t.length){var e,i,n=1,r=t.length,s=t[0];for(s=[s._x,s._y,s._x+s._w,s._y+s._h];n<r;)(i=[(e=t[n])._x,e._y,e._x+e._w,e._y+e._h])[0]<s[0]&&(s[0]=i[0]),i[1]<s[1]&&(s[1]=i[1]),i[2]>s[2]&&(s[2]=i[2]),i[3]>s[3]&&(s[3]=i[3]),n++;return{_x:(i=s)[0],_y:i[1],_w:i[2]-i[0],_h:i[3]-i[1]}}},_pool:(n=[],r=0,{get:function(t,e,i,s){n.length<=r&&n.push({});var o=n[r++];return o._x=t,o._y=e,o._w=i,o._h=s,o},copy:function(t){n.length<=r&&n.push({});var e=n[r++];return e._x=t._x,e._y=t._y,e._w=t._w,e._h=t._h,e},recycle:function(t){r--}})}})},4851:t=>{var e,i={},n=function(t){e=t||64,this.map={},this.boundsDirty=!1,this.coordBoundsDirty=!1,this.boundsHash={maxX:-1/0,maxY:-1/0,minX:1/0,minY:1/0},this.boundsCoords={maxX:-1/0,maxY:-1/0,minX:1/0,minY:1/0}};function r(t,e,i){this.keys=t,this.map=i,this.obj=e}n.key=function(t,i){return t=t._cbr||t._mbr||t,(i=i||{}).x1=Math.floor(t._x/e),i.y1=Math.floor(t._y/e),i.x2=Math.floor((t._w+t._x)/e),i.y2=Math.floor((t._h+t._y)/e),i},n.hash=function(t){return t.x1+" "+t.y1+" "+t.x2+" "+t.y2},n.cellsize=function(){return e},n.prototype={insert:function(t,e){var i,s,o,a=n.key(t,e&&e.keys);for(e=e||new r(a,t,this),i=a.x1;i<=a.x2;i++)for(s=a.y1;s<=a.y2;s++)o=i<<16^s,this.map[o]||(this.map[o]=[]),this.map[o].push(t);return this.boundsDirty=!0,e},_searchHolder:[],search:function(t,e){var r,s,o,a,h,u=n.key(t,i),c=this._searchHolder;for(e=e||[],c.length=0,r=u.x1;r<=u.x2;r++)for(s=u.y1;s<=u.y2;s++)if(a=this.map[r<<16^s])for(o=0;o<a.length;o++)c[a[o][0]]||(h=(h=c[a[o][0]]=a[o])._cbr||h._mbr||h)._x<t._x+t._w&&h._x+h._w>t._x&&h._y<t._y+t._h&&h._y+h._h>t._y&&e.push(a[o]);return e},unfilteredSearch:function(t,e){var r,s,o,a,h=n.key(t,i);for(e=e||[],r=h.x1;r<=h.x2;r++)for(s=h.y1;s<=h.y2;s++)if(a=this.map[r<<16^s])for(o=0;o<a.length;o++)e.push(a[o]);return e},remove:function(t){var e,i,n=t.keys,r=t.obj,s=0;for(s=n.x1;s<=n.x2;s++)for(e=n.y1;e<=n.y2;e++)if(i=s<<16^e,this.map[i]){var o,a=this.map[i],h=a.length;for(o=0;o<h;o++)a[o]&&a[o][0]===r[0]&&a.splice(o,1)}this.boundsDirty=!0},refresh:function(t){var e,i,r,s,o,a=t.keys,h=t.obj;for(i=a.x1;i<=a.x2;i++)for(r=a.y1;r<=a.y2;r++)if(e=this.map[i<<16^r])for(o=e.length,s=0;s<o;s++)e[s]&&e[s][0]===h[0]&&e.splice(s,1);for(n.key(h,a),i=a.x1;i<=a.x2;i++)for(r=a.y1;r<=a.y2;r++)(e=this.map[i<<16^r])||(e=this.map[i<<16^r]=[]),e.push(h);return this.boundsDirty=!0,t},boundaries:function(){this._updateBoundaries();var t=this.boundsCoords;return{min:{x:t.minX,y:t.minY},max:{x:t.maxX,y:t.maxY}}},_keyBoundaries:function(){return this._updateBoundaries(),this.boundsHash},_updateBoundaries:function(){if(this.boundsDirty||this.coordBoundsDirty){var t=this.boundsHash;this.boundsDirty&&(t.maxX=-1/0,t.maxY=-1/0,t.minX=1/0,t.minY=1/0);var e,i,n,r=this.boundsCoords;for(var s in r.maxX=-1/0,r.maxY=-1/0,r.minX=1/0,r.minY=1/0,this.map)if((n=this.map[s]).length){var o=s>>16,a=s<<16>>16;if(a<0&&(o=~o),o>=t.maxX)for(e in t.maxX=o,n)"object"==typeof(i=n[e])&&"requires"in i&&(r.maxX=Math.max(r.maxX,i.x+i.w));if(o<=t.minX)for(e in t.minX=o,n)"object"==typeof(i=n[e])&&"requires"in i&&(r.minX=Math.min(r.minX,i.x));if(a>=t.maxY)for(e in t.maxY=a,n)"object"==typeof(i=n[e])&&"requires"in i&&(r.maxY=Math.max(r.maxY,i.y+i.h));if(a<=t.minY)for(e in t.minY=a,n)"object"==typeof(i=n[e])&&"requires"in i&&(r.minY=Math.min(r.minY,i.y))}this.boundsDirty=!1,this.coordBoundsDirty=!1}},traverseRay:function(t,r,s){var o=r.x,a=r.y;t={_x:t._x,_y:t._y,_w:0,_h:0};var h,u,c=this._keyBoundaries(),l=n.key(t,i),d=l.x1,_=l.y1,p=c.minX,f=c.minY,g=c.maxX,v=c.maxY,y=o>0?1:o<0?-1:0,m=a>0?1:a<0?-1:0,w=a>=0?(_+1)*e:_*e,x=-1/0,b=0,M=0,T=1/0,D=1/0;for(0!==o&&(h=1/o,T=((o>=0?(d+1)*e:d*e)-t._x)*h,b=e*y*h),0!==a&&(h=1/a,D=(w-t._y)*h,M=e*m*h);1===y&&d<p&&p!==1/0||-1===y&&d>g&&g!==-1/0||1===m&&_<f&&f!==1/0||-1===m&&_>v&&v!==-1/0;)T<D?(x=T,d+=y,T+=b):(x=D,_+=m,D+=M);for(;p<=d&&d<=g&&f<=_&&_<=v;){if(u=this.map[d<<16^_])for(var C=0;C<u.length;C++)if(s(u[C],x))return;T<D?(x=T,d+=y,T+=b):(x=D,_+=m,D+=M)}}},r.prototype={update:function(t){n.hash(n.key(t,i))!==n.hash(this.keys)?this.map.refresh(this):this.map.coordBoundsDirty=!0}},t.exports=n}},e={};!function i(n){if(e[n])return e[n].exports;var r=e[n]={exports:{}};return t[n](r,r.exports,i),r.exports}(7373)})();